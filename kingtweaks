#!/system/bin/sh
# KTSR by pedro (pedrozzz0 @ GitHub)

MODPATH=/data/adb/modules/KTSR

# Load libraries
. $MODPATH/libs/libktsr.sh

# Check for root permissions and bail if not granted
if [[ "$(id -u)" -ne 0 ]]
then
kmsg1 "[!] No root permissions. Exiting."
exit 1
fi

if [[ -e $KLOG ]] 
then
rm "$KLOG"
fi

if [[ -d "/sdcard/KTSR" ]] 
then
touch "$KLOG"
fi

boot_run_once=false
kts_mode=$(getprop persist.kingtweaks.mode)
[ -z "$kts_mode" ] && setprop persist.kingtweaks.mode "1"

while true
do
sleep 3
if $boot_run_once
then
[ "$(getprop persist.kingtweaks.mode)" == "$kts_mode" ] && continue
else
boot_run_once=true
fi
kts_mode=$(getprop persist.kingtweaks.mode)

if [[ "$kts_mode" == "1" ]]
then
kts_profilein=Otomatis

elif [[ "$kts_mode" == "2" ]]
then
kts_profilein=Baterai

elif [[ "$kts_mode" == "3" ]]
then
kts_profilein=Seimbang

elif [[ "$kts_mode" == "4" ]]
then
kts_profilein=Ekstrim

elif [[ "$kts_mode" == "5" ]]
then
kts_profilein=Gaming
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilept=Automático

elif [[ "$kts_mode" == "2" ]]
then
kts_profilept=Bateria
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilept=Balanceado
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilept=Extremo
        	
elif [[ "$kts_mode" == "5" ]]
then
kts_profilept=Gaming
fi
	 	
if [[ "$kts_mode" == "1" ]]
then
kts_profile=Automatic

elif [[ "$kts_mode" == "2" ]]
then
kts_profile=Battery
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profile=Balanced
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profile=Extreme

elif [[ "$kts_mode" == "5" ]]
then
kts_profile=Gaming
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profiletr=Gecikme

elif [[ "$kts_mode" == "2" ]]
then
kts_profiletr=Batarya
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profiletr=Dengeli
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profiletr=Aşırı

elif [[ "$kts_mode" == "5" ]]
then
kts_profiletr=Oyun
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilefr=Automatique

elif [[ "$kts_mode" == "2" ]]
then
kts_profilefr=Batterie
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilefr=Modéré
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilefr=Extrême

elif [[ "$kts_mode" == "5" ]]
then
kts_profilefr=Jeu
fi

renice -n -6 $(pgrep system_server)
renice -n -6 $(pgrep com.miui.home)
renice -n -6 $(pgrep launcher)
renice -n -6 $(pgrep lawnchair)
renice -n -6 $(pgrep home)
renice -n -6 $(pgrep watchapp)
renice -n -6 $(pgrep trebuchet)
renice -n -6 $(pgrep deletescape)
renice -n -1 $(pgrep dialer)
renice -n -1 $(pgrep keyboard)
renice -n -1 $(pgrep inputmethod)
renice -n -9 $(pgrep fluid)
renice -n -10 $(pgrep composer)
renice -n -1 $(pgrep com.android.phone)
renice -n -10 $(pgrep surfaceflinger)
renice -n -2 $(pgrep kswapd0)
renice -n -1 $(pgrep ksmd)
renice -n -1 $(pgrep uksmd)
renice -n -7 $(pgrep msm_irqbalance)
renice -n -8 $(pgrep servicemanager)
renice -n -9 $(pgrep kgsl_worker)
renice -n -9 $(pgrep audioserver)
renice -n -3 $(pgrep thermal-engine)
renice -n -3 $(pgrep crtc_commit)
renice -n -3 $(pgrep crtc_event)
renice -n 4 $(pgrep android.gms)

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                                RENICED PROCESSES.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

case "$kts_profile" in
 "Automatic") {
 	sleep 5
   
 	. $MODPATH/libs/libktsr.sh

         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

         automatic
         
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	     };;
	 
	 "Balanced") {
	 	sleep 5
         
	 	. $MODPATH/libs/libktsr.sh
	 	
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

     	# Set SELinux to permissive temporally
     	if [[ "$slstatus" == "Enforcing" ]]; then
         write "/sys/fs/selinux/enforce" "0"
         fi
         
         killall kingauto
	 	balanced

	 	# Set it to enforcing again
     	if [[ "$slstatus" == "Permissive" ]]; then
         write "/sys/fs/selinux/enforce" "1"
         fi
         
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
	
	 	"Extreme") {
	 		sleep 5
            
	 		. $MODPATH/libs/libktsr.sh
	 		
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

     	# Set SELinux to permissive temporally
     	if [[ "$slstatus" == "Enforcing" ]]; then
         write "/sys/fs/selinux/enforce" "0"
         fi
         
             killall kingauto
	 		extreme
	 		
	 		# Set it to enforcing again
         	if [[ "$slstatus" == "Permissive" ]]; then
             write "/sys/fs/selinux/enforce" "1"
             fi
         
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
	 		
	 		"Battery") {
	 			sleep 5

	 			. $MODPATH/libs/libktsr.sh
	 			
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

     	# Set SELinux to permissive temporally
     	if [[ "$slstatus" == "Enforcing" ]]; then
         write "/sys/fs/selinux/enforce" "0"
         fi
         
                 killall kingauto
	 			battery

	 			# Set it to enforcing again
             	if [[ "$slstatus" == "Permissive" ]]; then
                 write "/sys/fs/selinux/enforce" "1"
                 fi
         
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;

	 			"Gaming") {
	 				sleep 5

	 				. $MODPATH/libs/libktsr.sh
	 				
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

     	# Set SELinux to permissive temporally
     	if [[ "$slstatus" == "Enforcing" ]]; then
         write "/sys/fs/selinux/enforce" "0"
         fi
         
                     killall kingauto
	 				gaming
	 				
	 				# Set it to enforcing again
                 	if [[ "$slstatus" == "Permissive" ]]; then
                     write "/sys/fs/selinux/enforce" "1"
                     fi

         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
esac
done