#!/system/bin/sh
# KTSR by pedro (pedrozzz0 @ GitHub)
# If you wanna use it as part of your project, please maintain the credits to it respective's author(s).

MODPATH=/data/adb/modules/KTSR

# Load libraries
. "$MODPATH"/libs/libktsr.sh

# Check for root permissions and bail if not granted
if [[ "$(id -u)" -ne 0 ]]
then
    kmsg2 "No root permissions. Exiting..."
    exit 1
fi

if [[ -e "$KLOG" ]] 
then
    rm "$KLOG"
fi

if [[ -d "/sdcard/KTSR" ]] 
then
    touch "$KLOG"
fi

if [[ -e "$KDBG" ]]
then
    rm "$KDBG"
fi

boot_run_once=false
kts_mode=$(getprop persist.kingtweaks.mode)
[ -z "$kts_mode" ] && setprop persist.kingtweaks.mode "1"

while true
do
sleep 3
if $boot_run_once
then
[ "$(getprop persist.kingtweaks.mode)" == "$kts_mode" ] && continue
else
boot_run_once=true
fi
kts_mode=$(getprop persist.kingtweaks.mode)

case $kts_mode in

1)
  kts_profilein=Otomatis
  ;;

    2)
     kts_profilein=Baterai
     ;;

      3)
       kts_profilein=Seimbang
       ;;

        4)
         kts_profilein=Ekstrim
         ;;

         5)
          kts_profilein=Gaming
          ;;

           6)
            kts_profilein=Latensi
            ;;
       esac

case $kts_mode in

1)
  kts_profilept=Automático
  ;;

  2)
   kts_profilept=Bateria
    ;;

    3)
     kts_profilept=Balanceado
     ;;
    
      4)
       kts_profilept=Extremo
       ;;
        	
        5)
         kts_profilept=Gaming
         ;;

         6)
          kts_profilept=Latência
          ;;
      esac

case $kts_mode in

1)
  kts_profile=Automatic
  ;;

  2)
    kts_profile=Battery
    ;;

     3)
      kts_profile=Balanced
      ;;

       4)
        kts_profile=Extreme
        ;;

        5)
         kts_profile=Gaming
         ;;

          6)
           kts_profile=Latency
           ;;
      esac

case $kts_mode in 

1)
  kts_profiletr=Gecikme
  ;;

    2)
     kts_profiletr=Batarya
     ;;

      3)
       kts_profiletr=Dengeli
       ;;

        4)
         kts_profiletr=Aşırı
         ;;

          5)
            kts_profiletr=Oyun
            ;;

             6)
              kts_profiletr=Gecikme
              ;;
         esac

case $kts_mode in
1)
  kts_profilefr=Automatique
  ;;

   2)
    kts_profilefr=Batterie
    ;;

     3)
       kts_profilefr=Modéré
       ;;

        4)
         kts_profilefr=Extrême
         ;;

          5)
           kts_profilefr=Jeu
           ;;

            6)
             kts_profilefr=Latence
             ;;
        esac

clear_logs() {
# Remove debug log if size is = / > 1 MB
kdbg_max_size=1000000

# Do the same to sqlite opt logs
sqlite_opt_max_size=1000000

if [[ "$(stat -t "$KDBG" | awk '{print $2}')" -eq "$kdbg_max_size" ]] || [[ "$(stat -t "$KLOG" | awk '{print $2}')" -gt "$kdbg_max_size" ]]; then
rm -f "$KDBG"

elif [[ "$(stat -t /sdcard/KTSR/sqlite_opt.log | awk '{print $2}')" -eq "$sqlite_opt_max_size" ]] || [[ "$(stat -t /sdcard/KTSR/sqlite_opt.log | awk '{print $2}')" -gt "$sqlite_opt_max_size" ]]; then
rm -f "/sdcard/KTSR/sqlite_opt.log"
fi
}

clear_logs 

case "$kts_profile" in
"Automatic") 

if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
then
    toast
     	
elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
then
    toast
         
elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
then
    toastpt
     	
elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
then
    toastin
     	
elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
then
    toasttr
     	
elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
then
    toastfr

elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
then
    toastfr

else
    toast
fi

automatic
         
if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
then
    toast1
     	
elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
then
    toast1
         
elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
then
    toastpt1
     	
elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
then
    toastin1
     	
elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
then
    toasttr1
     	
elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
then
    toastfr1

elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
then
    toastfr1

else
	toast1
fi
;;
	 
  "Balanced")

  if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
  then
      toast
     	
  elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
  then
      toast
         
  elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
  then
      toastpt
     	
  elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
  then
      toastin
     	
  elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
  then
      toasttr
     	
  elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
  then
      toastfr

  elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
  then
      toastfr

  else
      toast
  fi
     	  
    killall -9 kingauto
    balanced
	 	
  if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
  then
      toast1
     	
  elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
  then
      toast1
         
  elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
  then
      toastpt1
     	
  elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
  then
      toastin1
     	
  elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
  then
      toasttr1
     	
  elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
  then
      toastfr1

  elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
  then
      toastfr1

  else
      toast1
  fi
  ;;
	
	"Extreme") 

    if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
    then
        toast
     	
    elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
    then
        toast
         
    elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
    then
        toastpt
     	
    elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
    then
        toastin
     	
    elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
    then
        toasttr
     	
    elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
    then
        toastfr

    elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
    then
         toastfr

    else
        toast
    fi
     	   
      killall -9 kingauto
	  extreme
	 		 
      if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
      then
     	 toast1
     	
      elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
      then
          toast1
         
      elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
      then
     	 toastpt1
     	
      elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
      then
          toastin1

      elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
      then
     	 toasttr1
     	
      elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
      then
          toastfr1

      elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
      then
     	 toastfr1

      else
     	 toast1
      fi
	  ;;
	 		
	 	"Battery")
	
         if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
     	then
     	    toast
     	
     	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
         then
             toast
         
     	elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
     	then
         	toastpt
     	
     	elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
     	then
     	    toastin
     	
     	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
     	then
         	toasttr
     	
     	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
     	then
         	toastfr

     	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
     	then
         	toastfr

     	else
         	toast
     	fi
     	
           killall -9 kingauto
	 	  battery
	 			
         if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
     	then
         	toast1
     	
     	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
         then
             toast1
         
     	elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
     	then
         	toastpt1
     	
     	elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
     	then
         	toastin1
     	
     	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
     	then
         	toasttr1
     	
     	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
     	then
         	toastfr1

     	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
     	then
         	toastfr1

     	else
         	toast1
     	fi
	 	;;

	    	"Gaming")

            if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
        	then
            	toast
     	
        	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
            then
                toast
         
        	elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
        	then
            	toastpt
     	
        	elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
        	then
            	toastin
     	
        	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
        	then
            	toasttr
     	
        	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
        	then
            	toastfr

        	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
        	then
            	toastfr

        	else
            	toast
        	fi
         
              killall -9 kingauto
	 	     gaming
	 				
              if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
          	then
              	toast1
     	
          	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
              then
                  toast1
        
          	elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
          	then
              	toastpt1
     	
          	elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
          	then
              	toastin1
     	
          	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
          	then
              	toasttr1
     	
          	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
          	then
              	toastfr1

          	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
          	then
              	toastfr1

          	else
              	toast1
          	fi
	      	;;
	 	
	        	"Latency")

                if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
            	then
     	           toast
     	
            	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
                then
                    toast
         
            	elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
            	then
                	toastpt
     	
           	elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
               then
                   toastin
     	
           	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
           	then
               	toasttr
     	
           	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
           	then
               	toastfr
            
           	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
           	then
               	toastfr

           	else
               	toast
           	fi
         
                 killall -9 kingauto
	 			latency
	 				
                 if [[ "$(getprop persist.sys.locale)" == "en-US" ]]
             	then
                 	toast1
     	
             	elif [[ "$(getprop persist.sys.locale)" == "en-GB" ]]
                 then
                     toast1
         
     	        elif [[ "$(getprop persist.sys.locale)" == "pt-BR" ]]
             	then
                 	toastpt1
     	
     	        elif [[ "$(getprop persist.sys.locale)" == "id-ID" ]]
             	then
                 	toastin1
     	
             	elif [[ "$(getprop persist.sys.locale)" == "tr-TR" ]]
             	then
                 	toasttr1
     	
             	elif [[ "$(getprop persist.sys.locale)" == "fr-FR" ]]
             	then
                 	toastfr1

             	elif [[ "$(getprop persist.sys.locale)" == "fr-CA" ]]
             	then
                 	toastfr1

             	else
                 	toast1
             	fi
	         	;;
            esac
       done