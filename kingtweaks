#!/system/bin/sh
# Written by Draco (tytydraco @ GitHub)
# Modified by Pedrozzz (pedrozzz0 @ GitHub)
# If you wanna use it as part of your project, please maintain the credits to it respective's author(s).

MODPATH=/data/adb/modules/KTSR

LOG=/sdcard/KTS/KTS.log

if [[ -e $LOG ]] 
then
rm $LOG
fi

if [[ -d "/sdcard/KTS" ]] 
then
touch KTS.log

else
mkdir /sdcard/KTS
touch KTS.log
fi

# Log in white and continue (unnecessary)
kmsg() {
	echo -e "[*] $@" >> $LOG
	echo -e "[*] $@"
}

kmsg1() {
	echo -e "$@" >> $LOG
	echo -e "$@"
}

toasten() {
	am start -a android.intent.action.MAIN -e toasttext "Applying $kts_profile profile..." -n bellavita.toast/.MainActivity
}
	
toasten1() {
	am start -a android.intent.action.MAIN -e toasttext "$kts_profile profile applied" -n bellavita.toast/.MainActivity
}

toastpt() {
	am start -a android.intent.action.MAIN -e toasttext "Aplicando perfil $kts_profilept..." -n bellavita.toast/.MainActivity
}

toastpt1() {
	am start -a android.intent.action.MAIN -e toasttext "Perfil $kts_profilept aplicado" -n bellavita.toast/.MainActivity
}

toasttr() {
	am start -a android.intent.action.MAIN -e toasttext "$kts_profiletr profili uygulanƒ±yor..." -n bellavita.toast/.MainActivity
}

toasttr1() {
	am start -a android.intent.action.MAIN -e toasttext "$kts_profiletr profili uygulandƒ±" -n bellavita.toast/.MainActivity
}

toastin() {
	am start -a android.intent.action.MAIN -e toasttext "Menerapkan profil $kts_profilein..." -n bellavita.toast/.MainActivity
}

toastin1() {
	am start -a android.intent.action.MAIN -e toasttext "Profil $kts_profilein terpakai" -n bellavita.toast/.MainActivity
}

toastfr() {
	am start -a android.intent.action.MAIN -e toasttext "Chargement du profil $kts_profilefr..." -n bellavita.toast/.MainActivity
}

toastfr1() {
	am start -a android.intent.action.MAIN -e toasttext "Profil $kts_profilefr charg√©" -n bellavita.toast/.MainActivity
}

write() {
	# Bail out if file does not exist
	if [[ ! -f "$1" ]]
	then
    kmsg "$1 doesn't exist, skipping..."
    return 1
    fi

	# Fetch the current key value
	local curval=`cat "$1" 2> /dev/null`
	
	# Bail out if value is already set
	if [[ "$curval" == "$2" ]]
	then
	kmsg "$1 is already set to $2, skipping..."
	return 1
	fi

	# Make file writable in case it is not already
	chmod +w "$1" 2> /dev/null

	# Write the new value and bail if there's an error
	if ! echo "$2" > "$1" 2> /dev/null
	then
		kmsg1 "[!] Failed: $1 -> $2"
		return 0
	fi

	# Log the success
	kmsg "$1 $curval -> $2"
}

# Check for root permissions and bail if not granted
if [[ "`id -u`" -ne 0 ]]
then
kmsg1 "[!] No root permissions. Exiting."
exit 1
fi

# Detect if we are running on Android
grep -q android /proc/cmdline && ANDROID=true

# Duration in nanoseconds of one scheduling period
SCHED_PERIOD_LATENCY="$((1 * 1000 * 1000))"

SCHED_PERIOD_BALANCE="$((4 * 1000 * 1000))"

SCHED_PERIOD_BATTERY="$((8 * 1000 * 1000))"

SCHED_PERIOD_THROUGHPUT="$((10 * 1000 * 1000))"

# How many tasks should we have at a maximum in one scheduling period
SCHED_TASKS_LATENCY="10"

SCHED_TASKS_BATTERY="4"

SCHED_TASKS_BALANCE="8"

SCHED_TASKS_THROUGHPUT="6"

# Maximum unsigned integer size in C
UINT_MAX="4294967295"

    # Variable to GPU directories
    for gpul in /sys/devices/soc/*.qcom,kgsl-3d0/kgsl/kgsl-3d0
    do
    if [ -d "$gpul" ]; then
        gpu=$gpul
        fi
        done
        
    for gpul1 in /sys/devices/soc.0/*.qcom,kgsl-3d0/kgsl/kgsl-3d0
    do
    if [ -d "$gpul1" ]; then
        gpu=$gpul1
        fi
        done
        
    for gpul2 in /sys/devices/*.mali
    do
    if [ -d "$gpul2" ]; then
        gpu=$gpul2
        fi
        done
        
    for gpul3 in /sys/devices/platform/*.gpu
    do
    if [ -d "$gpul3" ]; then
        gpu=$gpul3
        fi
        done
        
    for gpul4 in /sys/devices/platform/mali-*.0
    do
    if [ -d "$gpul4" ]; then
        gpu=$gpul4
        fi
        done
        
	if [ -d "/sys/class/kgsl/kgsl-3d0" ]; then
		gpu="/sys/class/kgsl/kgsl-3d0"
	elif [ -d "/sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0" ]; then
		gpu="/sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0"
	elif [ -d "/sys/devices/platform/gpusysfs" ]; then
		gpu="/sys/devices/platform/gpusysfs"
	elif [ -d "/sys/devices/platform/mali.0" ]; then
		gpu="/sys/devices/platform/mali.0"
		fi
		
		for gpul in /sys/devices/soc/*.qcom,kgsl-3d0/kgsl/kgsl-3d0/devfreq
        do
        if [ -d "$gpul" ]; then
         gpug=$gpul
         fi
         done  
         
       for gpul1 in /sys/devices/soc.0/*.qcom,kgsl-3d0/kgsl/kgsl-3d0/devfreq
       do
       if [ -d "$gpul1" ]; then
        gpug=$gpul1
        fi
        done
        
      for gpul2 in /sys/devices/platform/*.gpu
      do
      if [ -d "$gpul2" ]; then
        gpug=$gpul2
        fi
        done
        
	if [ -d "/sys/class/kgsl/kgsl-3d0/devfreq" ]; then
		gpug="/sys/class/kgsl/kgsl-3d0/devfreq"
	elif [ -d "/sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/devfreq" ]; then
		gpug="/sys/devices/platform/kgsl-3d0.0/kgsl/kgsl-3d0/devfreq"
	elif [ -d "/sys/devices/platform/gpusysfs" ]; then
		gpug="/sys/devices/platform/gpusysfs"
	elif [ -d "/sys/module/mali/parameters" ]; then
		gpug="/sys/module/mali/parameters"		
	elif [ -d "/sys/kernel/gpu" ]; then
		gpug="/sys/kernel/gpu"
		fi

    if [[ -e $gpug/gpu_governor ]]; then
    GPU_GOVERNOR=`cat $gpug/gpu_governor`
    
    elif [[ -e $gpug/governor ]]; then
    GPU_GOVERNOR=`cat $gpug/governor`
    fi

    if [[ -e $gpu/min_pwrlevel ]]; then
    gpuminpl=`cat $gpu/min_pwrlevel`
    gpupl=$((gpuminpl + 1))
    fi
    
    gpumx=`cat $gpu/devfreq/available_frequencies | awk -v var="$gpupl" '{print $var}'`
    
    if [[ $gpumx != `cat $gpu/max_gpuclk` ]]; then
    gpumx=`cat $gpu/devfreq/available_frequencies | awk '{print $1}'`

    elif [[ $gpumx != `cat $gpu/max_gpuclk` ]]; then
    gpumx=$gpufreq
    fi
    
# Get running CPU governor    
for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
CPU_GOVERNOR=`cat $cpu/scaling_governor` 
done

# Get max CPU frequency
for cpu in /sys/devices/system/cpu/cpu*/cpufreq
do
cpumxfreq=`cat $cpu/scaling_max_freq`
cpumxfreq2=`cat $cpu/cpuinfo_max_freq`

if [[ $cpumxfreq2 > $cpumxfreq ]]; then
cpumxfreq=$cpumxfreq2
fi
done

# Max CPU frequency √∑ 2 
cpumfreq=$((cpumxfreq / 2))

# Get max GPU frequency
gpufreq=`cat $gpu/max_gpuclk`

# Max GPU frequency √∑ 2
gpumfreq=$((gpufreq / 2))

# Variable to SOC manufacturer
mf=`getprop ro.boot.hardware`

# Variable to device SOC
soc=`getprop ro.board.platform`

if [[ $soc == " " ]]; then
soc=`getprop ro.product.board`
fi

# Variable to device SDK
sdk=`getprop ro.build.version.sdk`

# Variable to device architeture
aarch=`getprop ro.product.cpu.abi | awk -F- '{print $1}'`

# Variable to device android release version
arv=`getprop ro.build.version.release`

# Variable to device model
dm=`getprop ro.product.model`

# Variable to get magisk version
magisk=`magisk -c`

# Detect if we're running on a exynos device
if [[ `$mf | grep 'samsungexynos'` ]]; then
exynos=true
else
exynos=false
fi

# Detect if we're running on a mediatek device
if [[ `$soc | grep 'mt'` ]]; then
mtk=true
else
mtk=false
fi

# Detect CPU scheduling type
for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ `cat $cpu/scaling_available_governors | grep 'util'` ]]; then
cpusched=EAS

elif [[ `cat $cpu/scaling_available_governors | grep 'interactive'` ]]; then
cpusched=HMP

else
cpusched=Unknown
fi
done

# Variable to total device ram
totalram=`free -m | awk '/Mem:/{print $2}'`

# Variable to battery actual capacity
bpercentage=`cat /sys/class/power_supply/battery/capacity`

# Variable to KTS version
bversion=`cat $MODPATH/module.prop | grep version= | sed "s/version=//"`

# Variable to KTS build type
btype=`cat $MODPATH/info.prop | grep buildtype= | sed "s/buildtype=//"`

# Variable to KTS build date
bdate=`cat $MODPATH/info.prop | grep builddate= | sed "s/builddate=//"`

# Variable to battery temperature
if [[ -e /sys/class/power_supply/battery/temp ]]
then
btemp=`cat /sys/class/power_supply/battery/temp`

elif [[ -e /sys/class/power_supply/battery/batt_temp ]]
then 
btemp=`cat /sys/class/power_supply/battery/batt_temp`
fi

btemp=$((btemp / 10))

# Automatic Profile
automatic() {
	     if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toasten
     	fi
     	
     	kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLING $kts_profile PROFILE...                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"       	

	sync
	kingauto
	
	kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          $kts_profile PROFILE ENABLED.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten1
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten1
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toasten1
     	fi
}
# Balanced Profile
balanced() {
         init=`date +%s`
         killall kingauto
         
         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toasten
     	fi
     	
kmsg1 "----------------------------------------------------- Info -------------------------------------------------------------------------------------------------"
kmsg1 "                                            üïõ Date of execution: $(date)                                                                                   " 
kmsg1 "                                            üîß Kernel: `uname -a`                                                                                           "
kmsg1 "                                            üõ†Ô∏è SOC: $mf, $soc                                                                                               "
kmsg1 "                                            ‚öôÔ∏è SDK: $sdk                                                                                                    "
kmsg1 "                                            ‚öíÔ∏è CPU Governor: $CPU_GOVERNOR                                                                                  "
kmsg1 "                                            ‚öñÔ∏è CPU Scheduling Type: $cpusched                                                                               "
kmsg1 "                                            ‚õìÔ∏è CPU AArch: $aarch                                                                                            "
kmsg1 "                                            üñºÔ∏è GPU Governor: $GPU_GOVERNOR                                                                                  "
kmsg1 "                                            üÖ∞Ô∏èndroid Version: $arv                                                                                          "
kmsg1 "                                            üì± Device: $dm                                                                                                  "
kmsg1 "                                            üëë KTS Version: $bversion                                                                                       "
kmsg1 "                                            üìÄ Build Type: $btype                                                                                           "
kmsg1 "                                            ‚è∞ Build Date: $bdate                                                                                           "
kmsg1 "                                            üîã Battery Charge Level: $bpercentage%                                                                          "
kmsg1 "                                            üå°Ô∏è Battery Temperature: $btemp¬∞C                                                                                "
kmsg1 "                                            üíæ Device RAM: $totalram MB                                                                                     "
kmsg1 "                                            üë∫ Magisk: $magisk                                                                                              "
kmsg1 "------------------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLING $kts_profile PROFILE...                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"       	

renice -n -6 $(pgrep system_server)
renice -n -6 $(pgrep com.miui.home)
renice -n -6 $(pgrep launcher)
renice -n -6 $(pgrep lawnchair)
renice -n -6 $(pgrep home)
renice -n -6 $(pgrep watchapp)
renice -n -6 $(pgrep trebuchet)
renice -n -6 $(pgrep deletescape)
renice -n -1 $(pgrep dialer)
renice -n -1 $(pgrep keyboard)
renice -n -1 $(pgrep inputmethod)
renice -n -9 $(pgrep fluid)
renice -n -10 $(pgrep composer)
renice -n -1 $(pgrep com.android.phone)
renice -n -10 $(pgrep surfaceflinger)
renice -n 1 $(pgrep kswapd0)
renice -n -2 $(pgrep ksmd)
renice -n -2 $(pgrep uksmd)
renice -n -6 $(pgrep msm_irqbalance)
renice -n -7 $(pgrep servicemanager)
renice -n -9 $(pgrep kgsl_worker)
renice -n -8 $(pgrep audioserver)
renice -n 1 $(pgrep thermal-engine)
renice -n 1 $(pgrep crtc_commit)
renice -n 1 $(pgrep crtc_event)
renice -n 6 $(pgrep android.gms)

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          RENICED PROCESSES.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

for panic in /proc/sys/*/*panic*
do
write "$panic" "0"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KERNEL PANIC.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable perfd, thermald and thermal-engine.
start perfd
start thermald
start thermal-engine
start mpdecision

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED THERMAL-ENGINE, THERMALD, MPDECISION AND PERFD.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable logd and statsd to reduce overhead.
stop logd
stop statsd

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED STATSD AND LOGD.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/cpu_boost/parameters/dynamic_stune_boost" ]]
then
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost" "10"
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost_ms" "150"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED STUNE BOOST.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

for corectl in /sys/devices/system/cpu/cpu*/core_ctl
do
if [[ -e "${corectl}/enable" ]]
then
write "${corectl}/enable" "1"

elif [[ -e "${corectl}/disable" ]]
then
write "${corectl}/disable" "0"
fi
done

if [[ -e "/sys/power/cpuhotplug/enable" ]]
then
write "/sys/power/cpuhotplug/enable" "1"

elif [[ -e "/sys/power/cpuhotplug/enabled" ]]
then
write "/sys/power/cpuhotplug/enabled" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED CORE CONTROL & CPU HOTPLUG.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# I/O Scheduler Tweaks
for queue in /sys/block/*/queue/
do
write "${queue}add_random" 0
write "${queue}iostats" 0
write "${queue}read_ahead_kb" 128
write "${queue}iosched/low_latency" 1
write "${queue}nomerges" 2
write "${queue}rq_affinity" 1
write "${queue}nr_requests" 64
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED I/O SCHEDULER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# CPU Tweaks
for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
avail_govs=`cat "${cpu}scaling_available_governors"`
if [[ "$avail_govs" == *"schedutil"* ]]
then
write "${cpu}scaling_governor" schedutil
write "${cpu}schedutil/up_rate_limit_us" "$((SCHED_PERIOD_BALANCE / 1000))"
write "${cpu}schedutil/down_rate_limit_us" "$((4 * SCHED_PERIOD_BALANCE / 1000))"
write "${cpu}schedutil/pl" "0"
write "${cpu}schedutil/iowait_boost_enable" "0"
write "${cpu}schedutil/rate_limit_us" "$((4 * SCHED_PERIOD_BALANCE / 1000))"
write "${cpu}schedutil/hispeed_load" "89"
write "${cpu}schedutil/hispeed_freq" "$cpumxfreq"
elif [[ "$avail_govs" == *"interactive"* ]]
then
write "${cpu}scaling_governor" interactive
write "${cpu}interactive/timer_rate" "40000"
write "${cpu}interactive/boost" "0"
write "${cpu}interactive/timer_slack" "40000"
write "${cpu}interactive/input_boost" "0"
write "${cpu}interactive/use_migration_notif" "1" 
write "${cpu}interactive/ignore_hispeed_on_notif" "1"
write "${cpu}interactive/use_sched_load" "1"
write "${cpu}interactive/boostpulse" "0"
write "${cpu}interactive/fastlane" "1"
write "${cpu}interactive/fast_ramp_down" "0"
write "${cpu}interactive/sampling_rate" "40000"
write "${cpu}interactive/sampling_rate_min" "50000"
write "${cpu}interactive/min_sample_time" "50000"
write "${cpu}interactive/go_hispeed_load" "89"
write "${cpu}interactive/hispeed_freq" "$cpumxfreq"
fi
done

for cpu in /sys/devices/system/cpu/cpu*
do
write "$cpu/online" "1"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         TWEAKED CPU.                                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# GPU Tweaks.
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/throttling" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/thermal_pwrlevel" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/adrenoboost" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_no_nap" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/bus_split" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/max_freq" `cat $gpu/max_gpuclk`
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/min_freq" "100000000"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/default_pwrlevel" "$gpuminpl"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_bus_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_clk_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_rail_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/idle_timer" "66"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/pwrnap" "1"

if [[ -e "/proc/gpufreq/gpufreq_limited_thermal_ignore" ]] 
then
write "/proc/gpufreq/gpufreq_limited_thermal_ignore" "0"
fi

# Enable dvfs
if [[ -e "/proc/mali/dvfs_enable" ]] 
then
write "/proc/mali/dvfs_enable" "1"
fi

if [[ -e "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" ]] 
then
write "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" "1"
fi

if [[ -e "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" ]]
then
write "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED GPU.                                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
	
# Enable and tweak adreno idler
if [[ -d "/sys/module/adreno_idler" ]]
then
write "/sys/module/adreno_idler/parameters/adreno_idler_active" "Y"
write "/sys/module/adreno_idler/parameters/adreno_idler_idleworkload" "6000"
write "/sys/module/adreno_idler/parameters/adreno_idler_downdifferential" "25"
write "/sys/module/adreno_idler/parameters/adreno_idler_idlewait" "25"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED AND TWEAKED ADRENO IDLER...                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Schedtune Tweaks
[[ $ANDROID == "true" ]] && if [[ -d "/dev/stune" ]]
then
write "/dev/stune/background/schedtune.boost" "0"
write "/dev/stune/background/schedtune.prefer_idle" "0"
write "/dev/stune/foreground/schedtune.prefer_perf" "0"

write "/dev/stune/foreground/schedtune.boost" "0"
write "/dev/stune/foreground/schedtune.prefer_idle" "1"
write "/dev/stune/foreground/schedtune.prefer_perf" "0"

write "/dev/stune/rt/schedtune.boost" "0"
write "/dev/stune/rt/schedtune.prefer_idle" "0"
write "/dev/stune/rt/schedtune.prefer_perf" "1"

write "/dev/stune/top-app/schedtune.boost" "10"
write "/dev/stune/top-app/schedtune.prefer_idle" "1"
write "/dev/stune/top-app/schedtune.prefer_perf" "1"

write "/dev/stune/schedtune.boost" "0"
write "/dev/stune/schedtune.prefer_idle" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDTUNE TWEAKS.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# FS Tweaks
if [[ -d "/proc/sys/fs" ]]
then
write "/proc/sys/fs/dir-notify-enable" "0"
write "/proc/sys/fs/lease-break-time" "15"
write "/proc/sys/fs/leases-enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED FS TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable dynamic_fsync
if [[ -e "/sys/kernel/dyn_fsync/Dyn_fsync_active" ]]
then
write "/sys/kernel/dyn_fsync/Dyn_fsync_active" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED DYNAMIC FSYNC.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Scheduler features
if [[ -e "/sys/kernel/debug/sched_features" ]]
then
write "/sys/kernel/debug/sched_features" "NEXT_BUDDY"
write "/sys/kernel/debug/sched_features" "TTWU_QUEUE"
write "/sys/kernel/debug/sched_features" "NO_GENTLE_FAIR_SLEEPERS"
write "/sys/kernel/debug/sched_features" "WAKEUP_PREEMPTION"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDULER FEATURES.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# OP Chain disable
if [[ -d "/sys/module/opchain" ]]
then
write "/sys/module/opchain/parameters/chain_on" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ONEPLUS CHAIN.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -d "/sys/module/mmc_core" ]];
then
write "/sys/module/mmc_core/parameters/crc" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CRC.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Tweak some kernel settings to improve overall performance
write "/proc/sys/kernel/sched_child_runs_first" "0"
write "/proc/sys/kernel/sched_boost" "0"
write "/proc/sys/kernel/perf_cpu_time_max_percent" "15"
write "/proc/sys/kernel/sched_autogroup_enabled" "1"
write "/proc/sys/kernel/random/read_wakeup_threshold" "64"
write "/proc/sys/kernel/random/write_wakeup_threshold" "256"
write "/proc/sys/kernel/sched_tunable_scaling" "0"
write "/proc/sys/kernel/sched_latency_ns" "$SCHED_PERIOD_BALANCE"
write "/proc/sys/kernel/sched_min_granularity_ns" "$((SCHED_PERIOD_BALANCE / SCHED_TASKS_BALANCE))"
write "/proc/sys/kernel/sched_wakeup_granularity_ns" "$((SCHED_PERIOD_BALANCE / 2))"
write "/proc/sys/kernel/sched_migration_cost_ns" "5000000"
[[ "$ANDROID" == "true" ]] && write "/proc/sys/kernel/sched_min_task_util_for_colocation" "0"
write "/proc/sys/kernel/sched_nr_migrate" "32"
write "/proc/sys/kernel/sched_schedstats" "0"
write "/proc/sys/kernel/sched_sync_hint_enable" "0"
write "/proc/sys/kernel/sched_user_hint" "0"
write "/proc/sys/kernel/printk_devkmsg" "off"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED KERNEL SETTINGS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable fingerprint boost
if [[ -e "/sys/kernel/fp_boost/enabled" ]]
then
write "/sys/kernel/fp_boost/enabled" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FINGERPRINT BOOST.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Set min and max clocks
for minclk in /sys/devices/system/cpu/cpufreq/policy*/
do
if [[ -e "${minclk}scaling_min_freq" ]]
then
write "${minclk}scaling_min_freq" "100000"
write "${minclk}scaling_max_freq" "$cpumxfreq"
fi
done

for mnclk in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ -e "${mnclk}scaling_min_freq" ]]
then
write "${mnclk}scaling_min_freq" "100000"
write "${mnclk}scaling_max_freq" "$cpumxfreq"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          SET MIN AND MAX CPU CLOCKS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/devices/system/cpu/cpuidle/use_deepest_state" ]] 
then
write "/sys/devices/system/cpu/cpuidle/use_deepest_state" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ALLOWED CPUIDLE TO USE DEEPEST STATE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable krait voltage boost
if [[ -e "/sys/module/acpuclock_krait/parameters/boost" ]] 
then
write "/sys/module/acpuclock_krait/parameters/boost" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KRAIT VOLTAGE BOOST.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

sync

# VM settings to improve overall user experience and smoothness.
write "/proc/sys/vm/drop_caches" "3"
write "/proc/sys/vm/dirty_background_ratio" "10"
write "/proc/sys/vm/dirty_ratio" "30"
write "/proc/sys/vm/dirty_expire_centisecs" "1000"
write "/proc/sys/vm/dirty_writeback_centisecs" "3000"
write "/proc/sys/vm/page-cluster" "0"
write "/proc/sys/vm/stat_interval" "60"
# Follow SSWAP on exynos SOC's
if [[ $exynos == "true" ]]; then
write "/proc/sys/vm/swappiness" "150"
else
write "/proc/sys/vm/swappiness" "100"
fi
write "/proc/sys/vm/laptop_mode" "0"
write "/proc/sys/vm/vfs_cache_pressure" "100"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED VM TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# MSM thermal tweaks
if [[ -d "/sys/module/msm_thermal" ]]
then
write /sys/module/msm_thermal/vdd_restriction/enabled "0"
write /sys/module/msm_thermal/core_control/enabled "1"
write /sys/module/msm_thermal/parameters/enabled "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED THERMAL TWEAKS.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable power efficient workqueue
if [[ -e "/sys/module/workqueue/parameters/power_efficient" ]]
then 
write "/sys/module/workqueue/parameters/power_efficient" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED POWER EFFICIENT WORKQUEUE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/devices/system/cpu/sched_mc_power_savings" ]]
then
write "/sys/devices/system/cpu/sched_mc_power_savings" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED MULTICORE POWER SAVINGS.                                                                     "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Fix DT2W.
if [[ -e "/sys/touchpanel/double_tap" && -e "/proc/tp_gesture" ]]
then
write "/sys/touchpanel/double_tap" "1"
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/class/sec/tsp/dt2w_enable ]]
then
write "/sys/class/sec/tsp/dt2w_enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/proc/tp_gesture" ]]
then
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/sys/touchpanel/double_tap" ]]
then
write "/sys/touchpanel/double_tap" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable touch boost on balance and battery profile
if [[ -e /sys/module/msm_performance/parameters/touchboost ]]
then
write "/sys/module/msm_performance/parameters/touchboost" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED TOUCH BOOST.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/power/pnpmgr/touch_boost ]]
then
write "/sys/power/pnpmgr/touch_boost" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED TOUCH BOOST.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Internet Tweaks
write "/proc/sys/net/ipv4/ip_no_pmtu_disc" "0"
write "/proc/sys/net/ipv4/tcp_ecn" "1"
write "/proc/sys/net/ipv4/tcp_timestamps" "0"
write "/proc/sys/net/ipv4/route.flush" "1"
write "/proc/sys/net/ipv4/tcp_rfc1337" "1"
write "/proc/sys/net/ipv4/tcp_tw_reuse" "1"
write "/proc/sys/net/ipv4/tcp_sack" "1"
write "/proc/sys/net/ipv4/tcp_fack" "1"
write "/proc/sys/net/ipv4/tcp_fastopen" "3"
write "/proc/sys/net/ipv4/tcp_tw_recycle" "1"
write "/proc/sys/net/ipv4/tcp_no_metrics_save" "1"
write "/proc/sys/net/ipv4/tcp_syncookies" "0"
write "/proc/sys/net/ipv4/tcp_window_scaling" "1"
write "/proc/sys/net/ipv4/tcp_keepalive_probes" "10"
write "/proc/sys/net/ipv4/tcp_keepalive_intvl" "30"
write "/proc/sys/net/ipv4/tcp_fin_timeout" "30"
write "/proc/sys/net/ipv4/tcp_low_latency" "1"
write "/proc/sys/net/ipv4/tcp_congestion_control" "bbr2"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED INTERNET TWEAKS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable high perf audio
for hpm in /sys/module/snd_soc_wcd*
do
if [[ -e "$hpm" ]]
then
write "${hpm}/parameters/high_perf_mode" "0"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED HIGH PERFORMANCE AUDIO.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable KSM
if [[ -e "/sys/kernel/mm/ksm/run" ]] 
then
write "/sys/kernel/mm/ksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED KSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable UKSM
elif [[ -e "/sys/kernel/mm/uksm/run" ]] 
then
write "/sys/kernel/mm/uksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED UKSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable LPM sleep in latency / balanced / battery profile
for lpm in /sys/module/lpm_levels/system/*/*/*/
do
if [[ -d "/sys/module/lpm_levels" ]]
then
write "/sys/module/lpm_levels/parameters/sleep_disabled" "N"
write "${lpm}idle_enabled" "Y"
write "${lpm}suspend_enabled" "Y"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED LPM SLEEP.                                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/pm2/parameters/idle_sleep_mode" ]] 
then
write "/sys/module/pm2/parameters/idle_sleep_mode" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED PM2 IDLE SLEEP MODE.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/lcd/panel/power_reduce" ]] 
then
write "/sys/class/lcd/panel/power_reduce" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED LCD POWER REDUCE.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/kernel/sched/gentle_fair_sleepers" ]]
then
write "/sys/kernel/sched/gentle_fair_sleepers" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED GENTLE FAIR SLEEPERS.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable Fast Charging Rate
if [[ -e "/sys/kernel/fast_charge/force_fast_charge" ]]
then
write "/sys/kernel/fast_charge/force_fast_charge" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED USB FAST CHARGING.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/sec/switch/afc_disable" ]];
then
write "/sys/class/sec/switch/afc_disable" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FAST CHARGING ON SAMSUNG DEVICES.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          $kts_profile PROFILE APPLIED WITH SUCCESS.                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          END OF EXECUTION: $(date)                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
exit=`date +%s`

exectime=$((exit - init))
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          EXECUTION DONE IN $exectime SECONDS.                                                                   "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten1
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten1
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toasten1
     	fi
}
# Extreme Profile
extreme() {
	init=`date +%s`
         killall kingauto
            
            if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toasten
     	fi
     	
kmsg1 "----------------------------------------------------- Info -------------------------------------------------------------------------------------------------"
kmsg1 "                                            üïõ Date of execution: $(date)                                                                                   " 
kmsg1 "                                            üîß Kernel: `uname -a`                                                                                           "
kmsg1 "                                            üõ†Ô∏è SOC: $mf, $soc                                                                                               "
kmsg1 "                                            ‚öôÔ∏è SDK: $sdk                                                                                                    "
kmsg1 "                                            ‚öíÔ∏è CPU Governor: $CPU_GOVERNOR                                                                                  "
kmsg1 "                                            ‚öñÔ∏è CPU Scheduling Type: $cpusched                                                                               "
kmsg1 "                                            ‚õìÔ∏è CPU AArch: $aarch                                                                                            "
kmsg1 "                                            üñºÔ∏è GPU Governor: $GPU_GOVERNOR                                                                                  "
kmsg1 "                                            üÖ∞Ô∏èndroid Version: $arv                                                                                          "
kmsg1 "                                            üì± Device: $dm                                                                                                  "
kmsg1 "                                            üëë KTS Version: $bversion                                                                                       "
kmsg1 "                                            üìÄ Build Type: $btype                                                                                           "
kmsg1 "                                            ‚è∞ Build Date: $bdate                                                                                           "
kmsg1 "                                            üîã Battery Charge Level: $bpercentage%                                                                          "
kmsg1 "                                            üå°Ô∏è Battery Temperature: $btemp¬∞C                                                                                "
kmsg1 "                                            üíæ Device RAM: $totalram MB                                                                                     "
kmsg1 "                                            üë∫ Magisk: $magisk                                                                                              "
kmsg1 "------------------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLING $kts_profile PROFILE...                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"       	
  
renice -n -6 $(pgrep system_server)
renice -n -6 $(pgrep com.miui.home)
renice -n -6 $(pgrep launcher)
renice -n -6 $(pgrep lawnchair)
renice -n -6 $(pgrep home)
renice -n -6 $(pgrep watchapp)
renice -n -6 $(pgrep trebuchet)
renice -n -6 $(pgrep deletescape)
renice -n -1 $(pgrep dialer)
renice -n -1 $(pgrep keyboard)
renice -n -1 $(pgrep inputmethod)
renice -n -9 $(pgrep fluid)
renice -n -10 $(pgrep composer)
renice -n -1 $(pgrep com.android.phone)
renice -n -10 $(pgrep surfaceflinger)
renice -n 1 $(pgrep kswapd0)
renice -n -2 $(pgrep ksmd)
renice -n -2 $(pgrep uksmd)
renice -n -6 $(pgrep msm_irqbalance)
renice -n -7 $(pgrep servicemanager)
renice -n -9 $(pgrep kgsl_worker)
renice -n -8 $(pgrep audioserver)
renice -n 1 $(pgrep thermal-engine)
renice -n 1 $(pgrep crtc_commit)
renice -n 1 $(pgrep crtc_event)
renice -n 6 $(pgrep android.gms)

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          RENICED PROCESSES.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

for panic in /proc/sys/*/*panic*
do
write "$panic" "0"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KERNEL PANIC.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable perfd, disable thermald and thermal-engine.
start perfd
stop thermald
stop thermal-engine
stop mpdecision

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED THERMAL-ENGINE, THERMALD, MPDECISION AND ENABLED PERFD.                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable logd and statsd to reduce overhead.
stop logd
stop statsd

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED STATSD AND LOGD.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/cpu_boost/parameters/dynamic_stune_boost" ]]
then
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost" "50"
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost_ms" "1500"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED STUNE BOOST.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

for corectl in /sys/devices/system/cpu/cpu*/core_ctl
do
if [[ -e "${corectl}/enable" ]]
then
write "${corectl}/enable" "0"

elif [[ -e "${corectl}/disable" ]]
then
write "${corectl}/disable" "1"
fi
done

if [[ -e "/sys/power/cpuhotplug/enable" ]]
then
write "/sys/power/cpuhotplug/enable" "0"

elif [[ -e "/sys/power/cpuhotplug/enabled" ]]
then
write "/sys/power/cpuhotplug/enabled" "0"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CORE CONTROL & CPU HOTPLUG.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Caf CPU Boost
if [[ -d "/sys/module/cpu_boost" ]]
then
write "/sys/module/cpu_boost/parameters/input_boost_freq" "0:$cpumxfreq 1:$cpumxfreq 2:$cpumxfreq 3:$cpumxfreq 4:$cpumxfreq 5:$cpumxfreq 6:$cpumxfreq 7:$cpumxfreq"
write "/sys/module/cpu_boost/parameters/input_boost_ms" "128"
write "/sys/module/cpu_boost/parameters/sched_boost_on_input" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED CAF INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# CPU input boost
elif [[ -d "/sys/module/cpu_input_boost" ]]
then
write "/sys/module/cpu_input_boost/parameters/input_boost_duration" "128"
write "/sys/module/cpu_input_boost/parameters/input_boost_freq_hp" "$cpumxfreq"
write "/sys/module/cpu_input_boost/parameters/input_boost_freq_lp" "$cpumxfreq"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED CPU INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# I/O Scheduler Tweaks
for queue in /sys/block/*/queue/
do
write "${queue}add_random" 0
write "${queue}iostats" 0
write "${queue}read_ahead_kb" 256
write "${queue}iosched/low_latency" 0
write "${queue}nomerges" 2
write "${queue}rq_affinity" 2
write "${queue}nr_requests" 128
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED I/O SCHEDULER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
avail_govs=`cat "${cpu}scaling_available_governors"`
if [[ "$avail_govs" == *"schedutil"* ]]
then
write "${cpu}scaling_governor" schedutil
write "${cpu}schedutil/up_rate_limit_us" "0"
write "${cpu}schedutil/down_rate_limit_us" "0"
write "${cpu}schedutil/pl" "1"
write "${cpu}schedutil/iowait_boost_enable" "1"
write "${cpu}schedutil/rate_limit_us" "0"
write "${cpu}schedutil/hispeed_load" "80"
write "${cpu}schedutil/hispeed_freq" "$UINT_MAX"
elif [[ "$avail_govs" == *"interactive"* ]]
then
write "${cpu}scaling_governor" interactive
write "${cpu}interactive/timer_rate" "0"
write "${cpu}interactive/boost" "1"
write "${cpu}interactive/timer_slack" "0"
write "${cpu}interactive/input_boost" "1"
write "${cpu}interactive/use_migration_notif" "1"
write "${cpu}interactive/ignore_hispeed_on_notif" "1"
write "${cpu}interactive/use_sched_load" "1"
write "${cpu}interactive/fastlane" "1"
write "${cpu}interactive/fast_ramp_down" "0"
write "${cpu}interactive/sampling_rate" "0"
write "${cpu}interactive/sampling_rate_min" "0"
write "${cpu}interactive/min_sample_time" "0"
write "${cpu}interactive/go_hispeed_load" "80"
write "${cpu}interactive/hispeed_freq" "$UINT_MAX"
fi
done
	
for cpu in /sys/devices/system/cpu/cpu*
do
write "$cpu/online" "1"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         TWEAKED CPU.                                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# GPU Tweaks.
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/throttling" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/thermal_pwrlevel" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/adrenoboost" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_no_nap" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/bus_split" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/max_freq" `cat $gpu/max_gpuclk`
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/min_freq" "100000000"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/default_pwrlevel" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_bus_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_clk_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_rail_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/idle_timer" "156"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/pwrnap" "1"

if [[ -e "/proc/gpufreq/gpufreq_limited_thermal_ignore" ]] 
then
write "/proc/gpufreq/gpufreq_limited_thermal_ignore" "0"
fi

# Enable dvfs
if [[ -e "/proc/mali/dvfs_enable" ]] 
then
write "/proc/mali/dvfs_enable" "1"
fi

if [[ -e "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" ]] 
then
write "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" "1"
fi

if [[ -e "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" ]]
then
write "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED GPU.                                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable adreno idler
if [[ -d "/sys/module/adreno_idler" ]]
then
write "/sys/module/adreno_idler/parameters/adreno_idler_active" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ADRENO IDLER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Schedtune Tweaks
[[ $ANDROID == "true" ]] && if [[ -d "/dev/stune" ]]
then
write "/dev/stune/background/schedtune.boost" "0"
write "/dev/stune/background/schedtune.prefer_idle" "0"
write "/dev/stune/background/schedtune.prefer_perf" "0"

write "/dev/stune/foreground/schedtune.boost" "50"
write "/dev/stune/foreground/schedtune.prefer_idle" "0"
write "/dev/stune/foreground/schedtune.prefer_perf" "1"

write "/dev/stune/rt/schedtune.boost" "0"
write "/dev/stune/rt/schedtune.prefer_idle" "0"
write "/dev/stune/rt/schedtune.prefer_perf" "0"

write "/dev/stune/top-app/schedtune.boost" "50"
write "/dev/stune/top-app/schedtune.prefer_idle" "0"
write "/dev/stune/top-app/schedtune.prefer_perf" "1"

write "/dev/stune/schedtune.boost" "0"
write "/dev/stune/schedtune.prefer_idle" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDTUNE TWEAKS.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# FS Tweaks
if [[ -d "/proc/sys/fs" ]]
then
write "/proc/sys/fs/dir-notify-enable" "0"
write "/proc/sys/fs/lease-break-time" "15"
write "/proc/sys/fs/leases-enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED FS TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable dynamic_fsync
if [[ -e "/sys/kernel/dyn_fsync/Dyn_fsync_active" ]]
then
write "/sys/kernel/dyn_fsync/Dyn_fsync_active" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED DYNAMIC FSYNC.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Scheduler features
if [[ -e "/sys/kernel/debug/sched_features" ]]
then
write "/sys/kernel/debug/sched_features" "NEXT_BUDDY"
write "/sys/kernel/debug/sched_features" "TTWU_QUEUE"
write "/sys/kernel/debug/sched_features" "NO_GENTLE_FAIR_SLEEPERS"
write "/sys/kernel/debug/sched_features" "NO_WAKEUP_PREEMPTION"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDULER FEATURES.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# OP Tweaks
if [[ -d "/sys/module/opchain" ]]
then
write "/sys/module/opchain/parameters/chain_on" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ONEPLUS CHAIN.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -d "/sys/module/mmc_core" ]];
then
write "/sys/module/mmc_core/parameters/crc" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CRC.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Tweak some kernel settings to improve overall performance.
write "/proc/sys/kernel/sched_child_runs_first" "0"
write "/proc/sys/kernel/sched_boost" "1"
write "/proc/sys/kernel/perf_cpu_time_max_percent" "25"
write "/proc/sys/kernel/sched_autogroup_enabled" "1"
write "/proc/sys/kernel/random/read_wakeup_threshold" "128"
write "/proc/sys/kernel/random/write_wakeup_threshold" "1024"
write "/proc/sys/kernel/sched_tunable_scaling" "0"
write "/proc/sys/kernel/sched_latency_ns" "$SCHED_PERIOD_THROUGHPUT"
write "/proc/sys/kernel/sched_min_granularity_ns" "$((SCHED_PERIOD_THROUGHPUT / SCHED_TASKS_THROUGHPUT))"
write "/proc/sys/kernel/sched_wakeup_granularity_ns" "$((SCHED_PERIOD_THROUGHPUT / 2))"
write "/proc/sys/kernel/sched_migration_cost_ns" "5000000"
[[ "$ANDROID" == "true" ]] && write "/proc/sys/kernel/sched_min_task_util_for_colocation" "0"
write "/proc/sys/kernel/sched_nr_migrate" "128"
write "/proc/sys/kernel/sched_schedstats" "0"
write "/proc/sys/kernel/sched_sync_hint_enable" "0"
write "/proc/sys/kernel/sched_user_hint" "0"
write "/proc/sys/kernel/sched_conservative_pl" "0"
write "/proc/sys/kernel/printk_devkmsg" "off"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED KERNEL SETTINGS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable fingerprint boost.
if [[ -e "/sys/kernel/fp_boost/enabled" ]]
then
write "/sys/kernel/fp_boost/enabled" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FINGERPRINT BOOST.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Set max clocks in gaming / performance profile.
for minclk in /sys/devices/system/cpu/cpufreq/policy*/
do
if [[ -e "${minclk}scaling_min_freq" ]]
then
write "${minclk}scaling_min_freq" "$cpumxfreq"
write "${minclk}scaling_max_freq" "$cpumxfreq"
fi
done

for mnclk in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ -e "${mnclk}scaling_min_freq" ]]
then
write "${mnclk}scaling_min_freq" "$cpumxfreq"
write "${mnclk}scaling_max_freq" "$cpumxfreq"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          SET MIN AND MAX CPU CLOCKS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/devices/system/cpu/cpuidle/use_deepest_state" ]] 
then
write "/sys/devices/system/cpu/cpuidle/use_deepest_state" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         NOT ALLOWED CPUIDLE TO USE DEEPEST STATE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable krait voltage boost
if [[ -e "/sys/module/acpuclock_krait/parameters/boost" ]] 
then
write "/sys/module/acpuclock_krait/parameters/boost" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED KRAIT VOLTAGE BOOST.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

sync

# VM settings to improve overall user experience and performance.
write "/proc/sys/vm/drop_caches" "3"
write "/proc/sys/vm/dirty_background_ratio" "5"
write "/proc/sys/vm/dirty_ratio" "30"
write "/proc/sys/vm/dirty_expire_centisecs" "500"
write "/proc/sys/vm/dirty_writeback_centisecs" "200"
write "/proc/sys/vm/page-cluster" "0"
write "/proc/sys/vm/stat_interval" "60"
# Follow SSWAP on exynos SOC's
if [[ $exynos == "true" ]]; then
write "/proc/sys/vm/swappiness" "150"
else
write "/proc/sys/vm/swappiness" "100"
fi
write "/proc/sys/vm/laptop_mode" "0"
write "/proc/sys/vm/vfs_cache_pressure" "80"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED VM TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# MSM thermal tweaks
if [[ -d "/sys/module/msm_thermal" ]]
then
write /sys/module/msm_thermal/vdd_restriction/enabled "0"
write /sys/module/msm_thermal/core_control/enabled "0"
write /sys/module/msm_thermal/parameters/enabled "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED THERMAL TWEAKS.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable power efficient workqueue.
if [[ -e "/sys/module/workqueue/parameters/power_efficient" ]]
then 
write "/sys/module/workqueue/parameters/power_efficient" "N" 
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED POWER EFFICIENT WORKQUEUE.                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/devices/system/cpu/sched_mc_power_savings" ]]
then
write "/sys/devices/system/cpu/sched_mc_power_savings" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED MULTICORE POWER SAVINGS.                                                                    "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Fix DT2W.
if [[ -e "/sys/touchpanel/double_tap" && -e "/proc/tp_gesture" ]]
then
write "/sys/touchpanel/double_tap" "1"
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/class/sec/tsp/dt2w_enable ]]
then
write "/sys/class/sec/tsp/dt2w_enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/proc/tp_gesture" ]]
then
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/sys/touchpanel/double_tap" ]]
then
write "/sys/touchpanel/double_tap" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable touch boost on gaming and performance profile.
if [[ -e /sys/module/msm_performance/parameters/touchboost ]]
then
write "/sys/module/msm_performance/parameters/touchboost" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED TOUCH BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/power/pnpmgr/touch_boost ]]
then
write "/sys/power/pnpmgr/touch_boost" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED TOUCH BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Internet Tweaks
write "/proc/sys/net/ipv4/ip_no_pmtu_disc" "0"
write "/proc/sys/net/ipv4/tcp_ecn" "1"
write "/proc/sys/net/ipv4/tcp_timestamps" "0"
write "/proc/sys/net/ipv4/route.flush" "1"
write "/proc/sys/net/ipv4/tcp_rfc1337" "1"
write "/proc/sys/net/ipv4/tcp_tw_reuse" "1"
write "/proc/sys/net/ipv4/tcp_sack" "1"
write "/proc/sys/net/ipv4/tcp_fack" "1"
write "/proc/sys/net/ipv4/tcp_fastopen" "3"
write "/proc/sys/net/ipv4/tcp_tw_recycle" "1"
write "/proc/sys/net/ipv4/tcp_no_metrics_save" "1"
write "/proc/sys/net/ipv4/tcp_syncookies" "0"
write "/proc/sys/net/ipv4/tcp_window_scaling" "1"
write "/proc/sys/net/ipv4/tcp_keepalive_probes" "10"
write "/proc/sys/net/ipv4/tcp_keepalive_intvl" "30"
write "/proc/sys/net/ipv4/tcp_fin_timeout" "30"
write "/proc/sys/net/ipv4/tcp_low_latency" "1"
write "/proc/sys/net/ipv4/tcp_congestion_control" "bbr2"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED INTERNET TWEAKS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable battery saver
if [[ -d "/sys/module/battery_saver" ]]
then
write "/sys/module/battery_saver/parameters/enabled" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED BATTERY SAVER.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable high perf audio
for hpm in /sys/module/snd_soc_wcd*
do
if [[ -e "$hpm" ]]
then
write "${hpm}/parameters/high_perf_mode" "1"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                           ENABLED HIGH PERFORMANCE AUDIO.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable KSM
if [[ -e "/sys/kernel/mm/ksm/run" ]] 
then
write "/sys/kernel/mm/ksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED KSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable UKSM
elif [[ -e "/sys/kernel/mm/uksm/run" ]] 
then
write "/sys/kernel/mm/uksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED UKSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable arch power
if [[ -e "/sys/kernel/sched/arch_power" ]] 
then
write "/sys/kernel/sched/arch_power" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ARCH POWER.                                                                                "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable LPM sleep in extreme / gaming profile
for lpm in /sys/module/lpm_levels/system/*/*/*/
do
if [[ -d "/sys/module/lpm_levels" ]]
then
write "/sys/module/lpm_levels/parameters/lpm_prediction" "N"
write "/sys/module/lpm_levels/parameters/sleep_disabled" "Y"
write "${lpm}idle_enabled" "N"
write "${lpm}suspend_enabled" "N"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED LPM SLEEP.                                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/pm2/parameters/idle_sleep_mode" ]] 
then
write "/sys/module/pm2/parameters/idle_sleep_mode" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED PM2 IDLE SLEEP MODE.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/lcd/panel/power_reduce" ]] 
then
write "/sys/class/lcd/panel/power_reduce" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED LCD POWER REDUCE..                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/kernel/sched/gentle_fair_sleepers" ]]
then
write "/sys/kernel/sched/gentle_fair_sleepers" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED GENTLE FAIR SLEEPERS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable Fast Charging Rate
if [[ -e "/sys/kernel/fast_charge/force_fast_charge" ]]
then
write "/sys/kernel/fast_charge/force_fast_charge" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED USB FAST CHARGING.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/sec/switch/afc_disable" ]];
then
write "/sys/class/sec/switch/afc_disable" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FAST CHARGING ON SAMSUNG DEVICES.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi
  
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          END OF EXECUTION: $(date)                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
exit=`date +%s`

exectime=$((exit - init))
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          EXECUTION DONE IN $exectime SECONDS.                                                                   "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten1
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten1
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toasten1
     	fi
}
# Battery Profile
battery() {
	init=`date +%s`
         killall kingauto
        	
        	if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toasten
     	fi
     	
kmsg1 "----------------------------------------------------- Info -------------------------------------------------------------------------------------------------"
kmsg1 "                                            üïõ Date of execution: $(date)                                                                                   " 
kmsg1 "                                            üîß Kernel: `uname -a`                                                                                           "
kmsg1 "                                            üõ†Ô∏è SOC: $mf, $soc                                                                                               "
kmsg1 "                                            ‚öôÔ∏è SDK: $sdk                                                                                                    "
kmsg1 "                                            ‚öíÔ∏è CPU Governor: $CPU_GOVERNOR                                                                                  "
kmsg1 "                                            ‚öñÔ∏è CPU Scheduling Type: $cpusched                                                                               "
kmsg1 "                                            ‚õìÔ∏è CPU AArch: $aarch                                                                                            "
kmsg1 "                                            üñºÔ∏è GPU Governor: $GPU_GOVERNOR                                                                                  "
kmsg1 "                                            üÖ∞Ô∏èndroid Version: $arv                                                                                          "
kmsg1 "                                            üì± Device: $dm                                                                                                  "
kmsg1 "                                            üëë KTS Version: $bversion                                                                                       "
kmsg1 "                                            üìÄ Build Type: $btype                                                                                           "
kmsg1 "                                            ‚è∞ Build Date: $bdate                                                                                           "
kmsg1 "                                            üîã Battery Charge Level: $bpercentage%                                                                          "
kmsg1 "                                            üå°Ô∏è Battery Temperature: $btemp¬∞C                                                                                "
kmsg1 "                                            üíæ Device RAM: $totalram MB                                                                                     "
kmsg1 "                                            üë∫ Magisk: $magisk                                                                                              "
kmsg1 "------------------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLING $kts_profile PROFILE...                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"       	
    	
renice -n -6 $(pgrep system_server)
renice -n -6 $(pgrep com.miui.home)
renice -n -6 $(pgrep launcher)
renice -n -6 $(pgrep lawnchair)
renice -n -6 $(pgrep home)
renice -n -6 $(pgrep watchapp)
renice -n -6 $(pgrep trebuchet)
renice -n -6 $(pgrep deletescape)
renice -n -1 $(pgrep dialer)
renice -n -1 $(pgrep keyboard)
renice -n -1 $(pgrep inputmethod)
renice -n -9 $(pgrep fluid)
renice -n -10 $(pgrep composer)
renice -n -1 $(pgrep com.android.phone)
renice -n -10 $(pgrep surfaceflinger)
renice -n 1 $(pgrep kswapd0)
renice -n -2 $(pgrep ksmd)
renice -n -2 $(pgrep uksmd)
renice -n -6 $(pgrep msm_irqbalance)
renice -n -7 $(pgrep servicemanager)
renice -n -9 $(pgrep kgsl_worker)
renice -n -8 $(pgrep audioserver)
renice -n 1 $(pgrep thermal-engine)
renice -n 1 $(pgrep crtc_commit)
renice -n 1 $(pgrep crtc_event)
renice -n 6 $(pgrep android.gms)

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          RENICED PROCESSES.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

for panic in /proc/sys/*/*panic*
do
write "$panic" "0"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KERNEL PANIC.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable perfd, thermald and thermal-engine.
start perfd
start thermald
start thermal-engine
start mpdecision

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED THERMAL-ENGINE, THERMALD, MPDECISION AND PERFD.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable logd and statsd to reduce overhead.
stop logd
stop statsd

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED STATSD AND LOGD.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/cpu_boost/parameters/dynamic_stune_boost" ]]
then
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost" "5"
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost_ms" "500"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED STUNE BOOST.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

for corectl in /sys/devices/system/cpu/cpu*/core_ctl
do
if [[ -e "${corectl}/enable" ]]
then
write "${corectl}/enable" "1"

elif [[ -e "${corectl}/disable" ]]
then
write "${corectl}/disable" "0"
fi
done

if [[ -e "/sys/power/cpuhotplug/enable" ]]
then
write "/sys/power/cpuhotplug/enable" "1"

elif [[ -e "/sys/power/cpuhotplug/enabled" ]]
then
write "/sys/power/cpuhotplug/enabled" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED CORE CONTROL & CPU HOTPLUG.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Caf CPU Boost
if [[ -e "/sys/module/cpu_boost/parameters/input_boost_ms" ]]
then
write "/sys/module/cpu_boost/parameters/input_boost_ms" "0"
write "/sys/module/cpu_boost/parameters/sched_boost_on_input" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CAF INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# CPU input boost
if [[ -e "/sys/module/cpu_input_boost/parameters/input_boost_duration" ]]
then
write "/sys/module/cpu_input_boost/parameters/input_boost_duration" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CPU INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# I/O Scheduler Tweaks
for queue in /sys/block/*/queue/
do
write "${queue}add_random" 0
write "${queue}iostats" 0
write "${queue}read_ahead_kb" 64
write "${queue}iosched/low_latency" 1
write "${queue}nomerges" 0
write "${queue}rq_affinity" 0
write "${queue}nr_requests" 32
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED I/O SCHEDULER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# CPU Tweaks
for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
avail_govs=`cat "${cpu}scaling_available_governors"`
if [[ "$avail_govs" == *"schedutil"* ]]
then
write "${cpu}scaling_governor" schedutil
write "${cpu}schedutil/up_rate_limit_us" "46000"
write "${cpu}schedutil/down_rate_limit_us" "24000"
write "${cpu}schedutil/pl" "0"
write "${cpu}schedutil/iowait_boost_enable" "0"
write "${cpu}schedutil/rate_limit_us" "46000"
write "${cpu}schedutil/hispeed_load" "99"
write "${cpu}schedutil/hispeed_freq" "$cpumfreq"
elif [[ "$avail_govs" == *"interactive"* ]]
then
write "${cpu}scaling_governor" interactive
write "${cpu}interactive/timer_rate" "50000"
write "${cpu}interactive/boost" "0"
write "${cpu}interactive/timer_slack" "50000"
write "${cpu}interactive/input_boost" "0"
write "${cpu}interactive/use_migration_notif" "1" 
write "${cpu}interactive/ignore_hispeed_on_notif" "1"
write "${cpu}interactive/use_sched_load" "1"
write "${cpu}interactive/boostpulse" "0"
write "${cpu}interactive/fastlane" "1"
write "${cpu}interactive/fast_ramp_down" "1"
write "${cpu}interactive/sampling_rate" "50000"
write "${cpu}interactive/sampling_rate_min" "75000"
write "${cpu}interactive/min_sample_time" "75000"
write "${cpu}interactive/go_hispeed_load" "99"
write "${cpu}interactive/hispeed_freq" "$cpumfreq"
fi
done

for cpu in /sys/devices/system/cpu/cpu*
do
if [[ $bpercentage < "20" ]]
then
write "/sys/devices/system/cpu/cpu1/online" "0"
write "/sys/devices/system/cpu/cpu2/online" "0"
write "/sys/devices/system/cpu/cpu5/online" "0"
write "/sys/devices/system/cpu/cpu6/online" "0"

elif [[ $bpercentage > "20" ]]
then
write "$cpu/online" "1"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         TWEAKED CPU.                                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# GPU Tweaks
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/throttling" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/thermal_pwrlevel" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/adrenoboost" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_no_nap" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/bus_split" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/max_freq" "$gpumfreq"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/min_freq" "100000000"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/default_pwrlevel" "$gpuminpl"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_bus_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_clk_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_rail_on" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/idle_timer" "36"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/pwrnap" "1"

if [[ -e "/proc/gpufreq/gpufreq_limited_thermal_ignore" ]] 
then
write "/proc/gpufreq/gpufreq_limited_thermal_ignore" "0"
fi

# Enable dvfs
if [[ -e "/proc/mali/dvfs_enable" ]] 
then
write "/proc/mali/dvfs_enable" "1"
fi

if [[ -e "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" ]] 
then
write "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" "1"
fi

if [[ -e "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" ]]
then
write "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         TWEAKED GPU.                                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable and tweak adreno idler
if [[ -d "/sys/module/adreno_idler" ]]
then
write "/sys/module/adreno_idler/parameters/adreno_idler_active" "Y"
write "/sys/module/adreno_idler/parameters/adreno_idler_idleworkload" "10000"
write "/sys/module/adreno_idler/parameters/adreno_idler_downdifferential" "35"
write "/sys/module/adreno_idler/parameters/adreno_idler_idlewait" "15"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         ENABLED AND TWEAKED ADRENO IDLER.                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Schedtune tweaks
[[ $ANDROID == "true" ]] && if [[ -d "/dev/stune" ]]
then
write "/dev/stune/background/schedtune.boost" "0"
write "/dev/stune/background/schedtune.prefer_idle" "0"
write "/dev/stune/background/schedtune.prefer_perf" "0"

write "/dev/stune/foreground/schedtune.boost" "1"
write "/dev/stune/foreground/schedtune.prefer_idle" "1"
write "/dev/stune/foreground/schedtune.prefer_perf" "0"

write "/dev/stune/rt/schedtune.boost" "0"
write "/dev/stune/rt/schedtune.prefer_idle" "0"
write "/dev/stune/rt/schedtune.prefer_perf" "0"

write "/dev/stune/top-app/schedtune.boost" "5"
write "/dev/stune/top-app/schedtune.prefer_idle" "1"
write "/dev/stune/top-app/schedtune.prefer_perf" "1"

write "/dev/stune/schedtune.boost" "0"
write "/dev/stune/schedtune.prefer_idle" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDTUNE TWEAKS.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# FS Tweaks
if [[ -d "/proc/sys/fs" ]]
then
write "/proc/sys/fs/dir-notify-enable" "0"
write "/proc/sys/fs/lease-break-time" "45"
write "/proc/sys/fs/leases-enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED FS TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi
    
# Enable dynamic_fsync
if [[ -e "/sys/kernel/dyn_fsync/Dyn_fsync_active" ]]
then
write "/sys/kernel/dyn_fsync/Dyn_fsync_active" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED DYNAMIC FSYNC.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Scheduler features
if [[ -e "/sys/kernel/debug/sched_features" ]]
then
write "/sys/kernel/debug/sched_features" "NEXT_BUDDY"
write "/sys/kernel/debug/sched_features" "TTWU_QUEUE"
write "/sys/kernel/debug/sched_features" "NO_WAKEUP_PREEMPTION"
write "/sys/kernel/debug/sched_features" "NO_GENTLE_FAIR_SLEEPERS"
write "/sys/kernel/debug/sched_features" "ARCH_POWER" 
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDULER FEATURES.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi
	
# OP Chain disable
if [[ -d "/sys/module/opchain" ]]
then
write "/sys/module/opchain/parameters/chain_on" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ONEPLUS CHAIN.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -d "/sys/module/mmc_core" ]];
then
write "/sys/module/mmc_core/parameters/crc" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CRC.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Tweak some kernel settings to improve overall performance.
write "/proc/sys/kernel/sched_child_runs_first" "1"
write "/proc/sys/kernel/sched_boost" "0"
write "/proc/sys/kernel/perf_cpu_time_max_percent" "10"
write "/proc/sys/kernel/sched_autogroup_enabled" "1"
write "/proc/sys/kernel/random/read_wakeup_threshold" "64"
write "/proc/sys/kernel/random/write_wakeup_threshold" "128"
write "/proc/sys/kernel/sched_tunable_scaling" "0"
write "/proc/sys/kernel/sched_latency_ns" "$SCHED_PERIOD_BATTERY"
write "/proc/sys/kernel/sched_min_granularity_ns" "$((SCHED_PERIOD_BATTERY / SCHED_TASKS_BATTERY))"
write "/proc/sys/kernel/sched_wakeup_granularity_ns" "$((SCHED_PERIOD_BATTERY / 2))"
write "/proc/sys/kernel/sched_migration_cost_ns" "5000000"
[[ "$ANDROID" == "true" ]] && write "/proc/sys/kernel/sched_min_task_util_for_colocation" "0"
write "/proc/sys/kernel/sched_nr_migrate" "8"
write "/proc/sys/kernel/sched_schedstats" "0"
write "/proc/sys/kernel/sched_sync_hint_enable" "0"
write "/proc/sys/kernel/sched_user_hint" "0"
write "/proc/sys/kernel/printk_devkmsg" "off"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED KERNEL SETTINGS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable fingerprint boost.
if [[ -e "/sys/kernel/fp_boost/enabled" ]]
then
write "/sys/kernel/fp_boost/enabled" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED FINGERPRINT BOOST.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Set min and max clocks.
for minclk in /sys/devices/system/cpu/cpufreq/policy*/
do
if [[ -e "${minclk}scaling_min_freq" && $bpercentage > "20" ]]
then
write "${minclk}scaling_min_freq" "100000"
write "${minclk}scaling_max_freq" "$cpumfreq"
fi
done

for mnclk in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ -e "${mnclk}scaling_min_freq" && $bpercentage > "20" ]]
then
write "${mnclk}scaling_min_freq" "100000"
write "${mnclk}scaling_max_freq" "$cpumfreq"
fi
done

# Set min and max clocks.
for minclk in /sys/devices/system/cpu/cpufreq/policy*/
do
if [[ -e "${minclk}scaling_min_freq" && $bpercentage < "20" ]]
then
write "${minclk}scaling_min_freq" "100000"
write "${minclk}scaling_max_freq" "$cpumxfreq"
fi
done

for mnclk in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ -e "${mnclk}scaling_min_freq" && $bpercentage < "20" ]]
then
write "${mnclk}scaling_min_freq" "100000"
write "${mnclk}scaling_max_freq" "$cpumxfreq"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          SET MIN AND MAX CPU CLOCKS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/devices/system/cpu/cpuidle/use_deepest_state" ]] 
then
write "/sys/devices/system/cpu/cpuidle/use_deepest_state" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ALLOWED CPUIDLE TO USE DEEPEST STATE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable krait voltage boost
if [[ -e "/sys/module/acpuclock_krait/parameters/boost" ]] 
then
write "/sys/module/acpuclock_krait/parameters/boost" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KRAIT VOLTAGE BOOST.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# VM settings to improve overall user experience and performance.
write "/proc/sys/vm/dirty_background_ratio" "5"
write "/proc/sys/vm/dirty_ratio" "50"
write "/proc/sys/vm/dirty_expire_centisecs" "3000"
write "/proc/sys/vm/dirty_writeback_centisecs" "3000"
write "/proc/sys/vm/page-cluster" "0"
write "/proc/sys/vm/stat_interval" "60"
# Follow SSWAP on exynos SOC's
if [[ $exynos == "true" ]]; then
write "/proc/sys/vm/swappiness" "150"
else
write "/proc/sys/vm/swappiness" "100"
fi
write "/proc/sys/vm/laptop_mode" "0"
write "/proc/sys/vm/vfs_cache_pressure" "60"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED VM TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# MSM thermal tweaks
if [[ -d "/sys/module/msm_thermal" ]]
then
write /sys/module/msm_thermal/vdd_restriction/enabled "1"
write /sys/module/msm_thermal/core_control/enabled "1"
write /sys/module/msm_thermal/parameters/enabled "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED THERMAL TWEAKS.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable power efficient workqueue.
if [[ -e "/sys/module/workqueue/parameters/power_efficient" ]]
then 
write "/sys/module/workqueue/parameters/power_efficient" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED POWER EFFICIENT WORKQUEUE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/devices/system/cpu/sched_mc_power_savings" ]]
then
write "/sys/devices/system/cpu/sched_mc_power_savings" "2"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED AGGRESSIVE MULTICORE POWER SAVINGS.                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Fix DT2W.
if [[ -e "/sys/touchpanel/double_tap" && -e "/proc/tp_gesture" ]]
then
write "/sys/touchpanel/double_tap" "1"
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/class/sec/tsp/dt2w_enable ]]
then
write "/sys/class/sec/tsp/dt2w_enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/proc/tp_gesture" ]]
then
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/sys/touchpanel/double_tap" ]]
then
write "/sys/touchpanel/double_tap" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable touch boost on battery and balance profile.
if [[ -e /sys/module/msm_performance/parameters/touchboost ]]
then
write "/sys/module/msm_performance/parameters/touchboost" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED TOUCH BOOST.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/power/pnpmgr/touch_boost ]]
then
write "/sys/power/pnpmgr/touch_boost" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED TOUCH BOOST.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Internet Tweaks
write "/proc/sys/net/ipv4/ip_no_pmtu_disc" "0"
write "/proc/sys/net/ipv4/tcp_ecn" "1"
write "/proc/sys/net/ipv4/tcp_timestamps" "0"
write "/proc/sys/net/ipv4/route.flush" "1"
write "/proc/sys/net/ipv4/tcp_rfc1337" "1"
write "/proc/sys/net/ipv4/tcp_tw_reuse" "1"
write "/proc/sys/net/ipv4/tcp_sack" "1"
write "/proc/sys/net/ipv4/tcp_fack" "1"
write "/proc/sys/net/ipv4/tcp_fastopen" "3"
write "/proc/sys/net/ipv4/tcp_tw_recycle" "1"
write "/proc/sys/net/ipv4/tcp_no_metrics_save" "1"
write "/proc/sys/net/ipv4/tcp_syncookies" "0"
write "/proc/sys/net/ipv4/tcp_window_scaling" "1"
write "/proc/sys/net/ipv4/tcp_keepalive_probes" "10"
write "/proc/sys/net/ipv4/tcp_keepalive_intvl" "30"
write "/proc/sys/net/ipv4/tcp_fin_timeout" "30"
write "/proc/sys/net/ipv4/tcp_low_latency" "1"
write "/proc/sys/net/ipv4/tcp_congestion_control" "bbr2"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED INTERNET TWEAKS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable battery saver
if [[ -d "/sys/module/battery_saver" ]]
then
write "/sys/module/battery_saver/parameters/enabled" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED BATTERY SAVER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable high perf audio
for hpm in /sys/module/snd_soc_wcd*
do
if [[ -e "$hpm" ]]
then
write "${hpm}/parameters/high_perf_mode" "0"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED HIGH PERFORMANCE AUDIO.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable KSM
if [[ -e "/sys/kernel/mm/ksm/run" ]] 
then
write "/sys/kernel/mm/ksm/run" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable UKSM
elif [[ -e "/sys/kernel/mm/uksm/run" ]] 
then
write "/sys/kernel/mm/uksm/run" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED UKSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable LPM sleep in latency / balanced / battery profile
for lpm in /sys/module/lpm_levels/system/*/*/*/
do
if [[ -d "/sys/module/lpm_levels" ]]
then
write "/sys/module/lpm_levels/parameters/lpm_prediction" "Y"
write "/sys/module/lpm_levels/parameters/sleep_disabled" "N"
write "${lpm}idle_enabled" "Y"
write "${lpm}suspend_enabled" "Y"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED LPM SLEEP.                                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/class/lcd/panel/power_reduce" ]] 
then
write "/sys/class/lcd/panel/power_reduce" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED LCD POWER REDUCE.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/kernel/sched/gentle_fair_sleepers" ]]
then
write "/sys/kernel/sched/gentle_fair_sleepers" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED GENTLE FAIR SLEEPERS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable Fast Charging Rate
if [[ -e "/sys/kernel/fast_charge/force_fast_charge" ]]
then
write "/sys/kernel/fast_charge/force_fast_charge" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED USB FAST CHARGING.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/sec/switch/afc_disable" ]];
then
write "/sys/class/sec/switch/afc_disable" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FAST CHARGING ON SAMSUNG DEVICES.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi
  
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          $kts_profile PROFILE APPLIED WITH SUCCESS.                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          END OF EXECUTION: $(date)                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
exit=`date +%s`

exectime=$((exit - init))
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          EXECUTION DONE IN $exectime SECONDS.                                                                   "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten1
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten1
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toasten1
     	fi
}
# Gaming Profile
gaming() {
	init=`date +%s`
         killall kingauto   
        	
        	if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toasten
     	fi
     	
kmsg1 "----------------------------------------------------- Info -------------------------------------------------------------------------------------------------"
kmsg1 "                                            üïõ Date of execution: $(date)                                                                                   " 
kmsg1 "                                            üîß Kernel: `uname -a`                                                                                           "
kmsg1 "                                            üõ†Ô∏è SOC: $mf, $soc                                                                                               "
kmsg1 "                                            ‚öôÔ∏è SDK: $sdk                                                                                                    "
kmsg1 "                                            ‚öíÔ∏è CPU Governor: $CPU_GOVERNOR                                                                                  "
kmsg1 "                                            ‚öñÔ∏è CPU Scheduling Type: $cpusched                                                                               "
kmsg1 "                                            ‚õìÔ∏è CPU AArch: $aarch                                                                                            "
kmsg1 "                                            üñºÔ∏è GPU Governor: $GPU_GOVERNOR                                                                                  "
kmsg1 "                                            üÖ∞Ô∏èndroid Version: $arv                                                                                          "
kmsg1 "                                            üì± Device: $dm                                                                                                  "
kmsg1 "                                            üëë KTS Version: $bversion                                                                                       "
kmsg1 "                                            üìÄ Build Type: $btype                                                                                           "
kmsg1 "                                            ‚è∞ Build Date: $bdate                                                                                           "
kmsg1 "                                            üîã Battery Charge Level: $bpercentage%                                                                          "
kmsg1 "                                            üå°Ô∏è Battery Temperature: $btemp¬∞C                                                                                "
kmsg1 "                                            üíæ Device RAM: $totalram MB                                                                                     "
kmsg1 "                                            üë∫ Magisk: $magisk                                                                                              "
kmsg1 "------------------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLING $kts_profile PROFILE...                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"       	

renice -n -6 $(pgrep system_server)
renice -n -6 $(pgrep com.miui.home)
renice -n -6 $(pgrep launcher)
renice -n -6 $(pgrep lawnchair)
renice -n -6 $(pgrep home)
renice -n -6 $(pgrep watchapp)
renice -n -6 $(pgrep trebuchet)
renice -n -6 $(pgrep deletescape)
renice -n -1 $(pgrep dialer)
renice -n -1 $(pgrep keyboard)
renice -n -1 $(pgrep inputmethod)
renice -n -9 $(pgrep fluid)
renice -n -10 $(pgrep composer)
renice -n -1 $(pgrep com.android.phone)
renice -n -10 $(pgrep surfaceflinger)
renice -n 1 $(pgrep kswapd0)
renice -n -2 $(pgrep ksmd)
renice -n -2 $(pgrep uksmd)
renice -n -6 $(pgrep msm_irqbalance)
renice -n -7 $(pgrep servicemanager)
renice -n -9 $(pgrep kgsl_worker)
renice -n -8 $(pgrep audioserver)
renice -n 1 $(pgrep thermal-engine)
renice -n 1 $(pgrep crtc_commit)
renice -n 1 $(pgrep crtc_event)
renice -n 6 $(pgrep android.gms)

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          RENICED PROCESSES.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

for panic in /proc/sys/*/*panic*
do
write "$panic" "0"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED KERNEL PANIC.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable perfd, thermald and thermal-engine.
stop perfd
stop thermald
stop thermal-engine
stop mpdecision

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED THERMAL-ENGINE, THERMALD, MPDECISION AND PERFD.                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable logd and statsd to reduce overhead.
stop logd
stop statsd

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED STATSD AND LOGD.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/cpu_boost/parameters/dynamic_stune_boost" ]]
then
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost" "50"
write "/sys/module/cpu_boost/parameters/dynamic_stune_boost_ms" "1500"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED STUNE BOOST.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

for corectl in /sys/devices/system/cpu/cpu*/core_ctl
do
if [[ -e "${corectl}/enable" ]]
then
write "${corectl}/enable" "0"

elif [[ -e "${corectl}/disable" ]]
then
write "${corectl}/disable" "1"
fi
done

if [[ -e "/sys/power/cpuhotplug/enable" ]]
then
write "/sys/power/cpuhotplug/enable" "0"

elif [[ -e "/sys/power/cpuhotplug/enabled" ]]
then
write "/sys/power/cpuhotplug/enabled" "0"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CORE CONTROL & CPU HOTPLUG.                                                                               "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Caf CPU Boost
if [[ -d "/sys/module/cpu_boost" ]]
then
write "/sys/module/cpu_boost/parameters/input_boost_freq" "0:$cpumxfreq 1:$cpumxfreq 2:$cpumxfreq 3:$cpumxfreq 4:$cpumxfreq 5:$cpumxfreq 6:$cpumxfreq 7:$cpumxfreq"
write "/sys/module/cpu_boost/parameters/input_boost_ms" "128"
write "/sys/module/cpu_boost/parameters/sched_boost_on_input" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED CAF INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# CPU input boost
elif [[ -d "/sys/module/cpu_input_boost" ]]
then
write "/sys/module/cpu_input_boost/parameters/input_boost_duration" "128"
write "/sys/module/cpu_input_boost/parameters/input_boost_freq_hp" "$cpumxfreq"
write "/sys/module/cpu_input_boost/parameters/input_boost_freq_lp" "$cpumxfreq"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED CPU INPUT BOOST.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# I/O Scheduler Tweaks
for queue in /sys/block/*/queue/
do
write "${queue}add_random" 0
write "${queue}iostats" 0
write "${queue}read_ahead_kb" 256
write "${queue}iosched/low_latency" 0
write "${queue}nomerges" 2
write "${queue}rq_affinity" 2
write "${queue}nr_requests" 128
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED I/O SCHEDULER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# CPU Tweaks
for cpu in /sys/devices/system/cpu/cpu*/cpufreq/
do
avail_govs=`cat "${cpu}scaling_available_governors"`
if [[ "$avail_govs" == *"schedutil"* ]]
then
write "${cpu}scaling_governor" schedutil
write "${cpu}schedutil/up_rate_limit_us" "0"
write "${cpu}schedutil/down_rate_limit_us" "0"
write "${cpu}schedutil/pl" "1"
write "${cpu}schedutil/iowait_boost_enable" "1"
write "${cpu}schedutil/rate_limit_us" "0"
write "${cpu}schedutil/hispeed_load" "80"
write "${cpu}schedutil/hispeed_freq" "$UINT_MAX"
elif [[ "$avail_govs" == *"interactive"* ]]
then
write "${cpu}scaling_governor" interactive
write "${cpu}interactive/timer_rate" "0"
write "${cpu}interactive/boost" "1"
write "${cpu}interactive/timer_slack" "0"
write "${cpu}interactive/input_boost" "1"
write "${cpu}interactive/use_migration_notif" "1"
write "${cpu}interactive/ignore_hispeed_on_notif" "1"
write "${cpu}interactive/use_sched_load" "1"
write "${cpu}interactive/boostpulse" "0"
write "${cpu}interactive/fastlane" "1"
write "${cpu}interactive/fast_ramp_down" "0"
write "${cpu}interactive/sampling_rate" "0"
write "${cpu}interactive/sampling_rate_min" "0"
write "${cpu}interactive/min_sample_time" "0"
write "${cpu}interactive/go_hispeed_load" "80"
write "${cpu}interactive/hispeed_freq" "$UINT_MAX"
fi
done

for cpu in /sys/devices/system/cpu/cpu*
do
write "$cpu/online" "1"
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         TWEAKED CPU.                                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# GPU Tweaks.
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/throttling" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/thermal_pwrlevel" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/adrenoboost" "2"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_no_nap" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/bus_split" "0"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/max_freq" `cat $gpu/max_gpuclk`
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/devfreq/min_freq" $gpumx
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/default_pwrlevel" `cat $gpu/max_pwrlevel`
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_bus_on" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_clk_on" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/force_rail_on" "1"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/idle_timer" "1006"
[[ $mtk == "false" ]] || [[ $exynos == "false" ]] && write "$gpu/pwrnap" "0"

if [[ -e "/proc/gpufreq/gpufreq_limited_thermal_ignore" ]]
then
write "/proc/gpufreq/gpufreq_limited_thermal_ignore" "1"
fi

# Enable dvfs
if [[ -e "/proc/mali/dvfs_enable" ]] 
then
write "/proc/mali/dvfs_enable" "1"
fi

if [[ -e "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" ]] 
then
write "/sys/module/pvrsrvkm/parameters/gpu_dvfs_enable" "1"
fi

if [[ -e "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" ]]
then
write "/sys/module/simple_gpu_algorithm/parameters/simple_gpu_activate" "1"
fi

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED GPU.                                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable adreno idler
if [[ -d "/sys/module/adreno_idler" ]]
then
write "/sys/module/adreno_idler/parameters/adreno_idler_active" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ADRENO IDLER.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Schedtune Tweaks
[[ $ANDROID == "true" ]] && if [[ -d "/dev/stune" ]]
then
write "/dev/stune/background/schedtune.boost" "0"
write "/dev/stune/background/schedtune.prefer_idle" "0"
write "/dev/stune/background/schedtune.prefer_perf" "0"

write "/dev/stune/foreground/schedtune.boost" "50"
write "/dev/stune/foreground/schedtune.prefer_idle" "0"
write "/dev/stune/foreground/schedtune.prefer_perf" "0"

write "/dev/stune/rt/schedtune.boost" "0"
write "/dev/stune/rt/schedtune.prefer_idle" "0"
write "/dev/stune/rt/schedtune.prefer_perf" "0"

write "/dev/stune/top-app/schedtune.boost" "50"
write "/dev/stune/top-app/schedtune.prefer_idle" "0"
write "/dev/stune/top-app/schedtune.prefer_perf" "1"

write "/dev/stune/schedtune.boost" "0"
write "/dev/stune/schedtune.prefer_idle" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDTUNE TWEAKS.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# FS Tweaks
if [[ -d "/proc/sys/fs" ]]
then
write "/proc/sys/fs/dir-notify-enable" "0"
write "/proc/sys/fs/lease-break-time" "15"
write "/proc/sys/fs/leases-enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                            APPLIED FS TWEAKS.                                                                                "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable dynamic_fsync
if [[ -e "/sys/kernel/dyn_fsync/Dyn_fsync_active" ]]
then
write "/sys/kernel/dyn_fsync/Dyn_fsync_active" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED DYNAMIC FSYNC.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Scheduler features
if [[ -e "/sys/kernel/debug/sched_features" ]]
then
write "/sys/kernel/debug/sched_features" "NEXT_BUDDY"
write "/sys/kernel/debug/sched_features" "TTWU_QUEUE"
write "/sys/kernel/debug/sched_features" "NO_GENTLE_FAIR_SLEEPERS"
write "/sys/kernel/debug/sched_features" "NO_WAKEUP_PREEMPTION"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED SCHEDULER FEATURES.                                                                           "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# OP Tweaks
if [[ -d "/sys/module/opchain" ]]
then
write "/sys/module/opchain/parameters/chain_on" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ONEPLUS CHAIN.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -d "/sys/module/mmc_core" ]];
then
write "/sys/module/mmc_core/parameters/crc" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED CRC.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Tweak some kernel settings to improve overall performance.
write "/proc/sys/kernel/sched_child_runs_first" "0"
write "/proc/sys/kernel/sched_boost" "1"
write "/proc/sys/kernel/perf_cpu_time_max_percent" "25"
write "/proc/sys/kernel/sched_autogroup_enabled" "1"
write "/proc/sys/kernel/random/read_wakeup_threshold" "128"
write "/proc/sys/kernel/random/write_wakeup_threshold" "1024"
write "/proc/sys/kernel/sched_tunable_scaling" "0"
write "/proc/sys/kernel/sched_latency_ns" "$SCHED_PERIOD_THROUGHPUT"
write "/proc/sys/kernel/sched_min_granularity_ns" "$((SCHED_PERIOD_THROUGHPUT / SCHED_TASKS_THROUGHPUT))"
write "/proc/sys/kernel/sched_wakeup_granularity_ns" "$((SCHED_PERIOD_THROUGHPUT / 2))"
write "/proc/sys/kernel/sched_migration_cost_ns" "5000000"
[[ "$ANDROID" == "true" ]] && write "/proc/sys/kernel/sched_min_task_util_for_colocation" "0"
write "/proc/sys/kernel/sched_nr_migrate" "128"
write "/proc/sys/kernel/sched_schedstats" "0"
write "/proc/sys/kernel/sched_sync_hint_enable" "0"
write "/proc/sys/kernel/sched_user_hint" "0"
write "/proc/sys/kernel/sched_conservative_pl" "0"
write "/proc/sys/kernel/printk_devkmsg" "off"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          TWEAKED KERNEL SETTINGS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable fingerprint boost.
if [[ -e "/sys/kernel/fp_boost/enabled" ]]
then
write "/sys/kernel/fp_boost/enabled" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FINGERPRINT BOOST.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Set max clocks in gaming / performance profile.
for minclk in /sys/devices/system/cpu/cpufreq/policy*/
do
if [[ -e "${minclk}scaling_min_freq" ]]
then
write "${minclk}scaling_min_freq" "$cpumxfreq"
write "${minclk}scaling_max_freq" "$cpumxfreq"
fi
done

for mnclk in /sys/devices/system/cpu/cpu*/cpufreq/
do
if [[ -e "${mnclk}scaling_min_freq" ]]
then
write "${mnclk}scaling_min_freq" "$cpumxfreq"
write "${mnclk}scaling_max_freq" "$cpumxfreq"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          SET MIN AND MAX CPU CLOCKS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/devices/system/cpu/cpuidle/use_deepest_state" ]] 
then
write "/sys/devices/system/cpu/cpuidle/use_deepest_state" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                         NOT ALLOWED CPUIDLE TO USE DEEPEST STATE.                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable krait voltage boost
if [[ -e "/sys/module/acpuclock_krait/parameters/boost" ]] 
then
write "/sys/module/acpuclock_krait/parameters/boost" "Y"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED KRAIT VOLTAGE BOOST.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

sync

# VM settings to improve overall user experience and performance.
write "/proc/sys/vm/drop_caches" "3"
write "/proc/sys/vm/dirty_background_ratio" "5"
write "/proc/sys/vm/dirty_ratio" "20"
write "/proc/sys/vm/dirty_expire_centisecs" "500"
write "/proc/sys/vm/dirty_writeback_centisecs" "200"
write "/proc/sys/vm/page-cluster" "0"
write "/proc/sys/vm/stat_interval" "60"
# Follow SSWAP on exynos SOC's
if [[ $exynos == "true" ]]; then
write "/proc/sys/vm/swappiness" "150"
else
write "/proc/sys/vm/swappiness" "100"
fi
write "/proc/sys/vm/laptop_mode" "0"
write "/proc/sys/vm/vfs_cache_pressure" "200"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED VM TWEAKS.                                                                                  "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# MSM thermal tweaks
if [[ -d "/sys/module/msm_thermal" ]]
then
write /sys/module/msm_thermal/vdd_restriction/enabled "0"
write /sys/module/msm_thermal/core_control/enabled "0"
write /sys/module/msm_thermal/parameters/enabled "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED THERMAL TWEAKS.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable power efficient workqueue.
if [[ -e "/sys/module/workqueue/parameters/power_efficient" ]]
then 
write "/sys/module/workqueue/parameters/power_efficient" "N" 
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED POWER EFFICIENT WORKQUEUE.                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/devices/system/cpu/sched_mc_power_savings" ]]
then
write "/sys/devices/system/cpu/sched_mc_power_savings" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED MULTICORE POWER SAVINGS.                                                                    "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Fix DT2W.
if [[ -e "/sys/touchpanel/double_tap" && -e "/proc/tp_gesture" ]]
then
write "/sys/touchpanel/double_tap" "1"
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/class/sec/tsp/dt2w_enable ]]
then
write "/sys/class/sec/tsp/dt2w_enable" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/proc/tp_gesture" ]]
then
write "/proc/tp_gesture" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e "/sys/touchpanel/double_tap" ]]
then
write "/sys/touchpanel/double_tap" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          FIXED DOUBLE TAP TO WAKEUP IF BROKEN.                                                                         "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable touch boost on gaming and performance profile.
if [[ -e /sys/module/msm_performance/parameters/touchboost ]]
then
write "/sys/module/msm_performance/parameters/touchboost" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED TOUCH BOOST.                                                                                "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

elif [[ -e /sys/power/pnpmgr/touch_boost ]]
then
write "/sys/power/pnpmgr/touch_boost" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED TOUCH BOOST.                                                                                "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Internet Tweaks
write "/proc/sys/net/ipv4/ip_no_pmtu_disc" "0"
write "/proc/sys/net/ipv4/tcp_ecn" "1"
write "/proc/sys/net/ipv4/tcp_timestamps" "0"
write "/proc/sys/net/ipv4/route.flush" "1"
write "/proc/sys/net/ipv4/tcp_rfc1337" "1"
write "/proc/sys/net/ipv4/tcp_tw_reuse" "1"
write "/proc/sys/net/ipv4/tcp_sack" "1"
write "/proc/sys/net/ipv4/tcp_fack" "1"
write "/proc/sys/net/ipv4/tcp_fastopen" "3"
write "/proc/sys/net/ipv4/tcp_tw_recycle" "1"
write "/proc/sys/net/ipv4/tcp_no_metrics_save" "1"
write "/proc/sys/net/ipv4/tcp_syncookies" "0"
write "/proc/sys/net/ipv4/tcp_window_scaling" "1"
write "/proc/sys/net/ipv4/tcp_keepalive_probes" "10"
write "/proc/sys/net/ipv4/tcp_keepalive_intvl" "30"
write "/proc/sys/net/ipv4/tcp_fin_timeout" "30"
write "/proc/sys/net/ipv4/tcp_low_latency" "1"
write "/proc/sys/net/ipv4/tcp_congestion_control" "bbr2"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          APPLIED INTERNET TWEAKS.                                                                            "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Disable battery saver
if [[ -d "/sys/module/battery_saver" ]]
then
write "/sys/module/battery_saver/parameters/enabled" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED BATTERY SAVER.                                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable high perf audio
for hpm in /sys/module/snd_soc_wcd*
do
if [[ -e "$hpm" ]]
then
write "${hpm}/parameters/high_perf_mode" "1"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED HIGH PERFORMANCE AUDIO.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable KSM
if [[ -e "/sys/kernel/mm/ksm/run" ]] 
then
write "/sys/kernel/mm/ksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED KSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

# Enable UKSM
elif [[ -e "/sys/kernel/mm/uksm/run" ]] 
then
write "/sys/kernel/mm/uksm/run" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED UKSM.                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable arch power
if [[ -e "/sys/kernel/sched/arch_power" ]] 
then
write "/sys/kernel/sched/arch_power" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED ARCH POWER.                                                                                "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Disable LPM sleep in extreme / gaming profile
for lpm in /sys/module/lpm_levels/system/*/*/*/
do
if [[ -d "/sys/module/lpm_levels" ]]
then
write "/sys/module/lpm_levels/parameters/lpm_prediction" "N"
write "/sys/module/lpm_levels/parameters/sleep_disabled" "Y"
write "${lpm}idle_enabled" "N"
write "${lpm}suspend_enabled" "N"
fi
done

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED LPM SLEEP.                                                                                 "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

if [[ -e "/sys/module/pm2/parameters/idle_sleep_mode" ]] 
then
write "/sys/module/pm2/parameters/idle_sleep_mode" "N"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED PM2 IDLE SLEEP MODE.                                                                       "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/lcd/panel/power_reduce" ]] 
then
write "/sys/class/lcd/panel/power_reduce" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED LCD POWER REDUCE.                                                                          "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/kernel/sched/gentle_fair_sleepers" ]]
then
write "/sys/kernel/sched/gentle_fair_sleepers" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          DISABLED GENTLE FAIR SLEEPERS.                                                                      "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

# Enable Fast Charging Rate
if [[ -e "/sys/kernel/fast_charge/force_fast_charge" ]]
then
write "/sys/kernel/fast_charge/force_fast_charge" "1"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED USB FAST CHARGING.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi

if [[ -e "/sys/class/sec/switch/afc_disable" ]];
then
write "/sys/class/sec/switch/afc_disable" "0"
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          ENABLED FAST CHARGING ON SAMSUNG DEVICES.                                                                        "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
fi
  
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          $kts_profile PROFILE APPLIED WITH SUCCESS.                                                             "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          END OF EXECUTION: $(date)                                                                              "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
exit=`date +%s`

exectime=$((exit - init))
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"
kmsg1 "                                          EXECUTION DONE IN $exectime SECONDS.                                                                   "
kmsg1 "-------------------------------------------------------------------------------------------------------------------------------------------------"

         if [[ `getprop persist.sys.locale` == "en-US" ]]
     	then
     	toasten1
     	
     	elif [[ `getprop persist.sys.locale` == "en-GB" ]]
         then
         toasten1
         
     	elif [[ `getprop persist.sys.locale` == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ `getprop persist.sys.locale` == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ `getprop persist.sys.locale` == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ `getprop persist.sys.locale` == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ `getprop persist.sys.locale` == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toasten1
     	fi
}
boot_run_once=false
kts_mode=$(getprop persist.kingtweaks.mode)
[ -z "$kts_mode" ] && setprop persist.kingtweaks.mode "1"

while true
do
sleep 3
if $boot_run_once
then
[ "$(getprop persist.kingtweaks.mode)" == "$kts_mode" ] && continue
else
boot_run_once=true
fi
kts_mode=$(getprop persist.kingtweaks.mode)

if [[ "$kts_mode" == "1" ]]
then
kts_profilein=Otomatis

elif [[ "$kts_mode" == "2" ]]
then
kts_profilein=Baterai

elif [[ "$kts_mode" == "3" ]]
then
kts_profilein=Seimbang

elif [[ "$kts_mode" == "4" ]]
then
kts_profilein=Ekstrim

elif [[ "$kts_mode" == "5" ]]
then
kts_profilein=Gaming
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilept=Autom√°tico

elif [[ "$kts_mode" == "2" ]]
then
kts_profilept=Bateria
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilept=Balanceado
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilept=Extremo
        	
elif [[ "$kts_mode" == "5" ]]
then
kts_profilept=Gaming
fi
	 	
if [[ "$kts_mode" == "1" ]]
then
kts_profile=Automatic

elif [[ "$kts_mode" == "2" ]]
then
kts_profile=Battery
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profile=Balanced
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profile=Extreme

elif [[ "$kts_mode" == "5" ]]
then
kts_profile=Gaming
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profiletr=Gecikme

elif [[ "$kts_mode" == "2" ]]
then
kts_profiletr=Batarya
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profiletr=Dengeli
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profiletr=A≈üƒ±rƒ±

elif [[ "$kts_mode" == "5" ]]
then
kts_profiletr=Oyun
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilefr=Automatique

elif [[ "$kts_mode" == "2" ]]
then
kts_profilefr=Batterie
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilefr=Mod√©r√©
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilefr=Extr√™me

elif [[ "$kts_mode" == "5" ]]
then
kts_profilefr=Jeu
fi

case "$kts_profile" in
 "Automatic") {
 	sleep 5
 	settings delete global device_idle_constants
     automatic
	 };;
	 
	 "Balanced") {
	 	sleep 5
	 	balanced
	 	};;
	
	 	"Battery") {
	 		sleep 5
	 		settings put global device_idle_constants inactive_to=60000,sensing_to=0,locating_to=0,location_accuracy=2000,motion_inactive_to=0,idle_after_inactive_to=0,idle_pending_to=60000,max_idle_pending_to=120000,idle_pending_factor=2.0,idle_to=900000,max_idle_to=21600000,idle_factor=2.0,max_temp_app_whitelist_duration=60000,mms_temp_app_whitelist_duration=30000,sms_temp_app_whitelist_duration=20000,light_after_inactive_to=10000,light_pre_idle_to=60000,light_idle_to=180000,light_idle_factor=2.0,light_max_idle_to=900000,light_idle_maintenance_min_budget=30000,light_idle_maintenance_max_budget=60000
	 		battery
	 		};;
	 		
	 		"Extreme") {
	 			sleep 5
	 			settings delete global device_idle_constants
	 			extreme
	 			};;

	 			"Gaming") {
	 				sleep 5
	 				settings delete global device_idle_constants
	 				gaming
	 				};;
esac
done