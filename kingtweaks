#!/system/bin/sh
# KTSR by pedro (pedrozzz0 @ GitHub)
# If you wanna use it as part of your project, please maintain the credits to it respective's author(s).

MODPATH=/data/adb/modules/KTSR

# Load libraries
. "$MODPATH"/libs/libktsr.sh

# Check for root permissions and bail if not granted
if [[ "$(id -u)" -ne 0 ]]
then
kmsg2 "No root permissions. Exiting..."
exit 1
fi

if [[ -e "$KLOG" ]] 
then
rm "$KLOG"
fi

if [[ -d "/sdcard/KTSR" ]] 
then
touch "$KLOG"
fi

if [[ -e "$KDBG" ]]
then
rm "$KDBG"
fi

boot_run_once=false
kts_mode=$(getprop persist.kingtweaks.mode)
[ -z "$kts_mode" ] && setprop persist.kingtweaks.mode "1"

while true
do
sleep 3
if $boot_run_once
then
[ "$(getprop persist.kingtweaks.mode)" == "$kts_mode" ] && continue
else
boot_run_once=true
fi
kts_mode=$(getprop persist.kingtweaks.mode)

if [[ "$kts_mode" == "1" ]]
then
kts_profilein=Otomatis

elif [[ "$kts_mode" == "2" ]]
then
kts_profilein=Baterai

elif [[ "$kts_mode" == "3" ]]
then
kts_profilein=Seimbang

elif [[ "$kts_mode" == "4" ]]
then
kts_profilein=Ekstrim

elif [[ "$kts_mode" == "5" ]]
then
kts_profilein=Gaming

elif [[ "$kts_mode" == "6" ]]
then
kts_profilein=Latensi
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilept=Automático

elif [[ "$kts_mode" == "2" ]]
then
kts_profilept=Bateria
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilept=Balanceado
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilept=Extremo
        	
elif [[ "$kts_mode" == "5" ]]
then
kts_profilept=Gaming

elif [[ "$kts_mode" == "6" ]]
then
kts_profilept=Latência
fi
	 	
if [[ "$kts_mode" == "1" ]]
then
kts_profile=Automatic

elif [[ "$kts_mode" == "2" ]]
then
kts_profile=Battery
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profile=Balanced
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profile=Extreme

elif [[ "$kts_mode" == "5" ]]
then
kts_profile=Gaming

elif [[ "$kts_mode" == "6" ]]
then
kts_profile=Latency
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profiletr=Gecikme

elif [[ "$kts_mode" == "2" ]]
then
kts_profiletr=Batarya
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profiletr=Dengeli
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profiletr=Aşırı

elif [[ "$kts_mode" == "5" ]]
then
kts_profiletr=Oyun

elif [[ "$kts_mode" == "6" ]]
then
kts_profiletr=Gecikme
fi

if [[ "$kts_mode" == "1" ]]
then
kts_profilefr=Automatique

elif [[ "$kts_mode" == "2" ]]
then
kts_profilefr=Batterie
        	
elif [[ "$kts_mode" == "3" ]]
then
kts_profilefr=Modéré
        	
elif [[ "$kts_mode" == "4" ]]
then
kts_profilefr=Extrême

elif [[ "$kts_mode" == "5" ]]
then
kts_profilefr=Jeu

elif [[ "$kts_mode" == "6" ]]
then
kts_profilefr=Latence
fi

renice -n -6 -p "$(pgrep system_server)"
renice -n -6 -p "$(pgrep com.miui.home)"
renice -n -6 -p "$(pgrep launcher)"
renice -n -6 -p "$(pgrep lawnchair)"
renice -n -6 -p "$(pgrep home)"
renice -n -6 -p "$(pgrep watchapp)"
renice -n -6 -p "$(pgrep trebuchet)"
renice -n -6 -p "$(pgrep deletescape)"
renice -n -1 -p "$(pgrep dialer)"
renice -n -1 -p "$(pgrep keyboard)"
renice -n -1 -p "$(pgrep inputmethod)"
renice -n -9 -p "$(pgrep fluid)"
renice -n -10 -p "$(pgrep composer)"
renice -n -1 -p "$(pgrep com.android.phone)"
renice -n -10 -p "$(pgrep surfaceflinger)"
renice -n -4 -p "$(pgrep kswapd0)"
renice -n -1 -p "$(pgrep ksmd)"
renice -n -1 -p "$(pgrep uksmd)"
renice -n -7 -p "$(pgrep msm_irqbalance)"
renice -n -8 -p "$(pgrep servicemanager)"
renice -n -9 -p "$(pgrep kgsl_worker)"
renice -n -9 -p "$(pgrep audioserver)"
renice -n -3 -p "$(pgrep thermal-engine)"
renice -n -3 -p "$(pgrep crtc_commit)"
renice -n -3 -p "$(pgrep crtc_event)"
renice -n 4 -p "$(pgrep android.gms)"

kmsg3 ""
kmsg "Reniced processes"
kmsg3 ""

# Remove main script log if the size is big
kdbgmaxsize=1000000

# Do the same to dbopt log
dboptmaxsize=1000000

if [[ "$(stat -t "$KDBG" | awk '{print $2}')" -eq "$kdbgmaxsize" ]] || [[ "$(stat -t "$KLOG" | awk '{print $2}')" -gt "$kdbgmaxsize" ]]; then
rm "$KDBG"

elif [[ "$(stat -t /sdcard/KTSR/dbopt.log | awk '{print $2}')" -eq "$dboptmaxsize" ]] || [[ "$(stat -t /sdcard/KTSR/dbopt.log | awk '{print $2}')" -gt "$dboptmaxsize" ]]; then
rm "/sdcard/KTSR/dbopt.log"
fi

case "$kts_profile" in
 "Automatic") {
 
 	. "$MODPATH"/libs/libktsr.sh

         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi

         automatic
         
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	     };;
	 
	 "Balanced") {
         
	 	. "$MODPATH"/libs/libktsr.sh
	 	
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi
     	  
         killall -9 kingauto
	 	balanced
	 	
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
	
	 	"Extreme") {
            
	 		. "$MODPATH"/libs/libktsr.sh
	 		
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi
     	   
             killall -9 kingauto
	 		extreme
	 		 
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
	 		
	 		"Battery") {

	 			. "$MODPATH"/libs/libktsr.sh
	 			
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi
     	
                 killall -9 kingauto
	 			battery
	 			
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;

	 			"Gaming") {
	 			
	 				. "$MODPATH"/libs/libktsr.sh
	 				
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi
         
                     killall -9 kingauto
	 				gaming
	 				
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
	 	
	 	"Latency") {
	 			
	 				. "$MODPATH"/libs/libktsr.sh
	 				
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr

     	else
     	toast
     	fi
         
                     killall -9 kingauto
	 				latency
	 				
         if [[ $(getprop persist.sys.locale) == "en-US" ]]
     	then
     	toast1
     	
     	elif [[ $(getprop persist.sys.locale) == "en-GB" ]]
         then
         toast1
         
     	elif [[ $(getprop persist.sys.locale) == "pt-BR" ]]
     	then
     	toastpt1
     	
     	elif [[ $(getprop persist.sys.locale) == "id-ID" ]]
     	then
     	toastin1
     	
     	elif [[ $(getprop persist.sys.locale) == "tr-TR" ]]
     	then
     	toasttr1
     	
     	elif [[ $(getprop persist.sys.locale) == "fr-FR" ]]
     	then
     	toastfr1

     	elif [[ $(getprop persist.sys.locale) == "fr-CA" ]]
     	then
     	toastfr1

     	else
     	toast1
     	fi
	 	};;
esac
done